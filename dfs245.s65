L00A0=$a0
L00A1=$a1
L00A2=$a2
L00A3=$a3
L00A4=$a4
L00A5=$a5
L00A6=$a6
L00A7=$a7
L00A8=$a8
L00A9=$a9
L00AA=$aa
L00AB=$ab
L00AE=$ae
L00B0=$b0
L00B1=$b1
L00B2=$b2
L00B3=$b3
L00B4=$b4
L00B5=$b5
L00B6=$b6
L00B7=$b7
L00B8=$b8
L00B9=$b9
L00BA=$ba
L00BB=$bb
L00BC=$bc
L00BD=$bd
L00BE=$be
L00C0=$c0
L00C1=$c1
L00C2=$c2
L00C3=$c3
L00C4=$c4
L00C5=$c5
L00C6=$c6
L00C7=$c7
L00C8=$c8
L00C9=$c9
L00CA=$ca
L00CC=$cc
L00CD=$cd
L00CE=$ce
L00CF=$cf
L00EF=$ef
L00F0=$f0
L00F1=$f1
L00F2=$f2
L00F3=$f3
L00F4=$f4
L00FF=$ff
L0100=$100
BYTEV=$20a
FILEV=$212
FSCV=$21e
intnmi=$d00
ecowsp=$d60
L0DF0=$df0
LC000=$c000
LC007=$c007
LC008=$c008
LC00E=$c00e
LC00F=$c00f
LC010=$c010
LC0F8=$c0f8
LC100=$c100
LC104=$c104
LC105=$c105
LC106=$c106
LC107=$c107
LC108=$c108
LC109=$c109
LC10A=$c10a
LC10B=$c10b
LC10C=$c10c
LC10D=$c10d
LC10E=$c10e
LC10F=$c10f
LC110=$c110
LC165=$c165
LC169=$c169
LC16D=$c16d
LC1A3=$c1a3
LC1A4=$c1a4
LC1A7=$c1a7
LC200=$c200
LC201=$c201
LC202=$c202
LC203=$c203
LC204=$c204
LC205=$c205
LC206=$c206
LC207=$c207
LC20E=$c20e
LC215=$c215
LC216=$c216
LC217=$c217
LC21E=$c21e
LC227=$c227
LC245=$c245
LC247=$c247
LC24D=$c24d
LC24E=$c24e
LC250=$c250
LC258=$c258
LC25F=$c25f
LC260=$c260
LC261=$c261
LC262=$c262
LC263=$c263
LC264=$c264
LC265=$c265
LC267=$c267
LC269=$c269
LC272=$c272
LC274=$c274
LC275=$c275
LC276=$c276
LC277=$c277
LC278=$c278
LC279=$c279
LC27A=$c27a
LC27D=$c27d
LC27E=$c27e
LC27F=$c27f
LC281=$c281
LC282=$c282
LC283=$c283
LC286=$c286
LC287=$c287
LC288=$c288
LC289=$c289
LC28A=$c28a
LC28B=$c28b
LC28C=$c28c
LC28F=$c28f
LC290=$c290
LC291=$c291
LC292=$c292
LC293=$c293
LC294=$c294
LC295=$c295
LC296=$c296
LC297=$c297
LC298=$c298
LC299=$c299
LC29A=$c29a
LC29B=$c29b
LC29D=$c29d
LC29E=$c29e
LC29F=$c29f
LC2A0=$c2a0
LC2A1=$c2a1
LC2A2=$c2a2
LC2A3=$c2a3
LC2A6=$c2a6
LC2C0=$c2c0
LC2C1=$c2c1
LC2C2=$c2c2
LC2C3=$c2c3
LC2C4=$c2c4
LC2C5=$c2c5
LC2C6=$c2c6
LC2C7=$c2c7
LC2C9=$c2c9
LC2CA=$c2ca
LC2CB=$c2cb
LC2CC=$c2cc
LC2CD=$c2cd
LC2CE=$c2ce
LC2CF=$c2cf
LC2D0=$c2d0
LC2D1=$c2d1
LC2D2=$c2d2
LC2D3=$c2d3
LC2D6=$c2d6
LC2D7=$c2d7
LC2D9=$c2d9
LC2DA=$c2da
LC2DB=$c2db
LC2DC=$c2dc
LC2DD=$c2dd
LC2DE=$c2de
LC2DF=$c2df
LC2E0=$c2e0
LC2E1=$c2e1
LC2E2=$c2e2
LC2E3=$c2e3
LC2E4=$c2e4
LC2E5=$c2e5
LC300=$c300
LC309=$c309
LC30B=$c30b
LC30C=$c30c
LC30D=$c30d
LC30E=$c30e
LC30F=$c30f
seqpl=$c310
LC311=$c311
LC312=$c312
seqbuf=$c313
LC314=$c314
LC315=$c315
LC316=$c316
LC317=$c317
LC318=$c318
LC319=$c319
LC31A=$c31a
LC31B=$c31b
LC31C=$c31c
seqdah=$c31d
LC4A5=$c4a5
LCC00=$cc00
LCC01=$cc01
LCC02=$cc02
LCD00=$cd00
LFE24=$fe24
fdccmd=$fe28
fcdtrk=$fe29
fdcsec=$fe2a
fdcdat=$fe2b
ROMSEL=$fe30
LFEE5=$fee5
GSINIT=$ffc2
GSREAD=$ffc5
OSRDCH=$ffe0
OSASCI=$ffe3
OSBYTE=$fff4
OSCLI=$fff7

;-------------------------------------------------------------------------

* = $8000
                .byte 0
                .byte 0
                .byte 0

;-------------------------------------------------------------------------

                jmp LA01F

;-------------------------------------------------------------------------

                .byte $82       ;
                .byte $11
                .byte $95       ;
                .text "DFS"
                .byte 0
                .text "2.45"
                .byte 0
                .text "(C)1985 Acorn"
                .byte 0

;-------------------------------------------------------------------------

L8020:
                jmp (FSCV)

;-------------------------------------------------------------------------

brk_with_Prefix_Disc:
                jsr estrng
                brk

;-------------------------------------------------------------------------

aDisc:          .text "Disc "

;-------------------------------------------------------------------------

                bcc L804F

brk_with_prefix_Bad:
                jsr estrng

;-------------------------------------------------------------------------

aBad:           .byte 0
                .text "Bad "

;-------------------------------------------------------------------------

                bcc L804F

;-------------------------------------------------------------------------

estrng:
                lda LC2DD
                bne L8040
                jsr L98E3

L8040:
                lda #$FF
                sta LC282
                sta LC2DD

;-------------------------------------------------------------------------

do_following_brk:
                ldx #2
                lda #0
                sta L0100

;-------------------------------------------------------------------------

L804F:
                sta L00B3
                pla
                sta L00AE
                pla
                sta L00AE+1
                lda L00B3
                ldy #0
                jsr L83E4
                lda (L00AE),y
                sta L0100+1
                dex

L8064:
                jsr L83E4
                inx
                lda (L00AE),y
                sta L0100,x
                bmi L8097
                bne L8064
                jsr L8F9E
                bit LC2A6
                bmi L807C
                jsr L9877

L807C:
                jmp L0100

;-------------------------------------------------------------------------

vstrng:
                sta L00B3
                pla
                sta L00AE
                pla
                sta L00AE+1
                lda L00B3
                pha

vstrlp:
                jsr L83E4
                lda (L00AE)
                bmi vstrnx
                jsr pchr
                bra vstrlp

;-------------------------------------------------------------------------

vstrnx:
                pla

L8097:
                clc
                jmp (L00AE)

;-------------------------------------------------------------------------

L809B:
                jsr L80C3

;-------------------------------------------------------------------------

pdot:
                lda #'.'

;-------------------------------------------------------------------------

pchr:
                jsr savita
                pha
                lda #$EC
                jsr readby
                txa
                pha
                ora #$10
                jsr wriwde
                plx
                pla
                jsr OSASCI
                jmp LA5C8

;-------------------------------------------------------------------------

                jsr L841D

;-------------------------------------------------------------------------

L80BB:
                pha
                jsr L81BE
                jsr L80C3
                pla

;-------------------------------------------------------------------------

L80C3:
                jsr L80C8
                bne pchr

;-------------------------------------------------------------------------

L80C8:
                and #$F
                cmp #$A
                bcc L80D0
                adc #6

L80D0:
                adc #'0'
                rts

;-------------------------------------------------------------------------

L80D3:
                jsr L80E3
                dex
                dex
                jsr L80DB

L80DB:
                lda (L00B0),y
                sta LC272,x
                inx
                iny
                rts

;-------------------------------------------------------------------------

L80E3:
                jsr L80E6

L80E6:
                lda (L00B0),y
                sta L00BA,x
                inx
                iny
                rts

;-------------------------------------------------------------------------

L80ED:
                jsr L8B52
                jmp L8103

;-------------------------------------------------------------------------

L80F3:
                jsr L8B52

L80F6:
                lda L00BA
                sta L00F2
                lda L00BB
                sta L00F3
                ldy #0
                jsr L8703

L8103:
                ldx #' '
                jsr L8149
                bcs L8125
                sta LC200
                cmp #'.'
                bne L8115

L8111:
                stx L00CC
                beq L8103

L8115:
                cmp #':'
                bne L812E
                jsr L8B62
                jsr L8149
                bcs L8125
                cmp #'.'
                beq L8103

L8125:
                jsr brk_with_prefix_Bad

;-------------------------------------------------------------------------

                .byte $CC
aName:          .text "name"
                .byte 0

;-------------------------------------------------------------------------

L812E:
                tax
                jsr L8149
                bcs L815D
                cmp #'.'
                beq L8111
                ldx #1

L813A:
                sta LC200,x
                inx
                jsr L8149
                bcs L815F
                cpx #7
                bne L813A
                beq L8125

;-------------------------------------------------------------------------

L8149:
                jsr GSREAD
                php
                and #$7F
                cmp #$D
                beq L815B
                cmp #$20
                bcc L8125
                cmp #$7F
                beq L8125

L815B:
                plp
                rts

;-------------------------------------------------------------------------

L815D:
                ldx #1

L815F:
                lda #$20

L8161:
                sta LC200,x
                inx
                cpx #$40
                bne L8161
                ldx #6

L816B:
                lda LC200,x
                sta L00C5,x
                dex
                bpl L816B
                rts

;-------------------------------------------------------------------------

prtnam:
                jsr savita
                lda LC00F,y
                php
                and #$7F
                bne L8184
                jsr LADCF
                beq L818A

L8184:
                jsr pchr
                jsr pdot

L818A:
                ldx #6

ptnam0:
                lda LC008,y
                and #$7F
                jsr pchr
                iny
                dex
                bpl ptnam0
                jsr LADCF
                lda #' '
                plp
                bpl ptnam1
                lda #'L'

ptnam1:
                jsr pchr
                ldy #1

yspace:
                jsr LADD2
                dey
                bne yspace
                rts

;-------------------------------------------------------------------------

isoexe:
                lsr a
                lsr a

;-------------------------------------------------------------------------

L81B0:
                jsr L81BE
                and #3
                rts

;-------------------------------------------------------------------------

L81B6:
                and #8
                beq rts81BC
                lda #3

rts81BC:
                rts

;-------------------------------------------------------------------------

L81BD:
                lsr a

;-------------------------------------------------------------------------

L81BE:
                lsr a

L81BF:
                lsr a
                lsr a
                lsr a
                rts

;-------------------------------------------------------------------------

L81C3:
                asl a

L81C4:
                asl a
                asl a
                asl a
                asl a
                rts

;-------------------------------------------------------------------------

L81C9:
                lda #5
                sta LC295
                lda L00CD
                sta LC290
                lda #$A
                sta L00B0
                lda L00BC
                sta LC291
                lda L00BD
                sta LC292
                lda LC274
                sta LC293
                lda LC275
                sta LC294
                lda #$FF
                sta LC297
                lda L00C2
                jsr L81B0
                sta LC29A
                lda L00C0
                sta LC29B
                lda L00C1
                sta LC299
                lda L00C2
                and #3
                tax
                lda L00C3

L820B:
                sec

L820C:
                inc LC297
                sbc L00B0
                bcs L820C
                dex
                bpl L820B
                adc L00B0
                sta LC298

rts821B:
                rts

;-------------------------------------------------------------------------

L821C:
                jsr L80ED
                bmi L8224

L8221:
                jsr L80F3

L8224:
                jsr lookup
                bcs rts821B

L8229:
                jsr do_following_brk

;-------------------------------------------------------------------------

                .byte $D6
aNotFound:      .text "Not found"
                .byte 0

;-------------------------------------------------------------------------

L8237:
                jsr L86FC
                jsr L8B52
                jsr L8703
                beq L8245
                jsr L8961

L8245:
                lda #'*'
                sta LC200
                jsr L815D
                jsr LA4A7
                jsr L8224
                jmp L8264

;-------------------------------------------------------------------------

L8256:
                jsr L86FC
                jsr LA4A7
                jsr L8703
                beq L826D
                jsr L821C

L8264:
                jsr L8342
                jsr L828A
                bcs L8264
                rts

;-------------------------------------------------------------------------

L826D:
                jmp L8125

;-------------------------------------------------------------------------

L8270:
                jsr L943E
                lda #0
                bra L8295

;-------------------------------------------------------------------------

L8277:
                ldx #6

L8279:
                lda L00C5,x
                sta LC258,x
                dex
                bpl L8279
                lda #' '
                sta LC25F
                lda #'X'
                bne L8290

;-------------------------------------------------------------------------

L828A:
                ldx #0
                bra L8298

;-------------------------------------------------------------------------

lookup:
                lda #0

L8290:
                pha
                jsr L9442
                pla

L8295:
                tax
                stz L00B6

L8298:
                ldy #0
                lda #$C0
                sta L00B7
                lda L00B6
                cmp LC105
                bcs L82EE
                adc #8
                sta L00B6
                jsr L82C3
                bcc L8298
                lda L00CC
                ldy #7
                jsr L82F0
                bne L8298
                ldy L00B6
                sec

L82BA:
                dey
                dey
                dey
                dey
                dey
                dey
                dey
                dey
                rts

;-------------------------------------------------------------------------

L82C3:
                jsr savita

L82C6:
                lda LC200,x
                cmp LC2CE
                bne L82E1
                inx

L82CF:
                jsr L82C3
                bcs rts82EF
                iny
                cpy #7
                bcc L82CF

L82D9:
                lda LC200,x
                cmp #$20
                bne L82EE
                rts

;-------------------------------------------------------------------------

L82E1:
                cpy #7
                bcs L82D9
                jsr L82F0
                bne L82EE
                inx
                iny
                bne L82C6

L82EE:
                clc

rts82EF:
                rts

;-------------------------------------------------------------------------

L82F0:
                cmp LC2CE
                beq rts8305
                cmp LC2CD
                beq rts8305
                jsr L832F
                eor (L00B6),y
                bcs L8303
                and #$5F

L8303:
                and #$7F

rts8305:
                rts

;-------------------------------------------------------------------------

L8306:
                php
                jsr L832F
                bcs L830E
                and #$5F

L830E:
                and #$7F
                plp
                rts

;-------------------------------------------------------------------------

L8312:
                jsr LA55B

L8315:
                lda LC010,y
                sta LC008,y
                lda LC110,y
                sta LC108,y
                iny
                cpy LC105
                bcc L8315
                tya
                sbc #8
                sta LC105
                clc

rts832E:
                rts

;-------------------------------------------------------------------------

L832F:
                pha
                and #$5f
                cmp #'A'
                bcc L833A
                cmp #'['
                bcc L833B

L833A:
                sec

L833B:
                pla
                rts

;-------------------------------------------------------------------------

L833D:
                bit LC2C6
                bmi rts832E

;-------------------------------------------------------------------------

L8342:
                jsr savita
                jsr prtnam
                tya
                pha
                lda #<LC260
                sta L00B0
                lda #>LC260
                sta L00B1
                jsr L838E
                ldy #2
                jsr LADD2
                jsr L8376
                jsr L8376
                jsr L8376
                pla
                tay
                lda LC10E,y
                and #3
                jsr L80C3
                lda LC10F,y
                jsr L80BB
                jmp LA7DD

;-------------------------------------------------------------------------

L8376:
                ldx #3

L8378:
                lda LC262,y
                jsr L80BB
                dey
                dex
                bne L8378
                jsr iny7
                jmp LADD2

;-------------------------------------------------------------------------

L8388:
                jsr savita
                jmp L9451

;-------------------------------------------------------------------------

L838E:
                jsr savita
                tya
                pha
                tax
                ldy #$12
                lda #0

L8398:
                dey
                sta (L00B0),y
                cpy #2
                bne L8398

L839F:
                jsr L83D9
                iny
                iny
                cpy #$E
                bne L839F
                pla
                tax
                lda LC00F,x
                bpl L83B3
                lda #8
                sta (L00B0),y

L83B3:
                lda LC10E,x
                ldy #4
                jsr L83C7
                ldy #$C
                lsr a
                lsr a
                pha
                and #3
                sta (L00B0),y
                pla
                ldy #8

;-------------------------------------------------------------------------

L83C7:
                lsr a
                lsr a
                pha
                and #3
                cmp #3
                bne L83D5
                lda #$FF
                sta (L00B0),y
                iny

L83D5:
                sta (L00B0),y
                pla
                rts

;-------------------------------------------------------------------------

L83D9:
                jsr L83DC

L83DC:
                lda LC108,x
                sta (L00B0),y
                inx
                iny
                rts

;-------------------------------------------------------------------------

L83E4:
                inc L00AE
                bne rts83EA
                inc L00AE+1

rts83EA:
                rts

;-------------------------------------------------------------------------

savita:
                pha
                phx
                phy
                lda #$84
                pha
                lda #$B
                pha

L83F4:
                ldy #5

L83F6:
                tsx
                lda $107,x
                pha
                dey
                bne L83F6
                ldy #$A

L8400:
                lda $109,x
                sta $10B,x
                dex
                dey
                bne L8400
                pla
                pla

L840C:
                ply
                plx
                pla
                rts

;-------------------------------------------------------------------------

savit:
                pha
                phx
                phy
                jsr L83F4
                tsx
                sta $103,x
                jmp L840C

;-------------------------------------------------------------------------

L841D:
                jsr savit
                tay
                beq rts842D
                clc
                sed
                lda #0

L8427:
                adc #1
                dey
                bne L8427
                cld

rts842D:
                rts

;-------------------------------------------------------------------------

                and #$7F
                cmp #$7F
                beq L8438
                cmp #' '
                bcs rts843A

L8438:
                lda #'.'

rts843A:
                rts

;-------------------------------------------------------------------------

L843B:
                sec
                sbc #'0'
                bcc L8456
                cmp #$A
                rts

;-------------------------------------------------------------------------

                jsr L8306
                jsr L843B
                bcc rts8455
                sbc #7
                bcc L8456
                cmp #$A
                bcc L8456
                cmp #$10

rts8455:
                rts

;-------------------------------------------------------------------------

L8456:
                sec
                rts

;-------------------------------------------------------------------------

L8458:
                jsr L8703
                sec
                beq rts8482
                php
                stz L00B9
                bra L8477

;-------------------------------------------------------------------------

L8463:
                jsr L843B
                bcs L8481
                sta L00B8
                lda L00B9
                asl a
                sta L00B9
                asl a
                asl a
                adc L00B9
                adc L00B8
                sta L00B9

L8477:
                jsr GSREAD
                bcc L8463
                lda L00B9
                plp
                clc
                rts

;-------------------------------------------------------------------------

L8481:
                plp

rts8482:
                rts

;-------------------------------------------------------------------------

L8483:
                jsr L86FC
                jsr L8B5D
                jsr L9451
                ldy #$FF
                sty L00A8
                iny
                sty L00AA

L8493:
                lda LC000,y
                cpy #8
                bcc L849D
                lda LC0F8,y

L849D:
                jsr pchr
                iny
                cpy #$C
                bne L8493
                jsr vstrng
                .text " ("
                
                lda LC104
                jsr L80BB
                jsr vstrng
                .text ") FM"
                .byte $D
                .text "Drive "

                lda L00CD
                jsr L80C3
                ldy #$D
                jsr yspace
                jsr vstrng
                .text "Option "

                lda LC106
                jsr L81BE
                pha
                jsr L80C3
                jsr vstrng
                .text " ("

                ldy #3
                pla
                asl a
                asl a
                tax

L84E7:
                lda aOff,x      ; "off"
                jsr pchr
                inx
                dey
                bpl L84E7
                jsr vstrng
                .text ')'
                .byte $D
                .text "Dir. :"

                lda LC2CA
                jsr L809B
                lda LC2C9
                jsr pchr
                ldy #$B
                jsr yspace
                jsr vstrng
                .text "Lib. :"

                lda LC2CC
                jsr L809B
                lda LC2CB
                jsr pchr
                jsr LA7DD
                ldy #0

L8527:
                cpy LC105
                bcs L8543
                lda LC00F,y
                eor LC2C9
                and #$5F
                bne L853E
                lda LC00F,y
                and #$80
                sta LC00F,y

L853E:
                jsr iny8

L8541:
                bcc L8527

L8543:
                ldy #0
                jsr L8555
                bcc L8560
                lda #$FF
                sta LC282
                jmp LA7DD

;-------------------------------------------------------------------------

L8552:
                jsr iny8

;-------------------------------------------------------------------------

L8555:

                cpy LC105
                bcs rts855F
                lda LC008,y
                bmi L8552

rts855F:
                rts

;-------------------------------------------------------------------------

L8560:
                sty L00AB
                ldx #0

L8564:
                lda LC008,y
                jsr L8306
                sta LC260,x
                iny
                inx
                cpx #8
                bne L8564

L8573:
                jsr L8555
                bcs L859B
                sec
                ldx #6

L857B:
                lda LC00E,y
                jsr L8306
                sbc LC260,x
                dey
                dex
                bpl L857B
                jsr iny7
                lda LC00F,y
                jsr L8306
                sbc LC267
                bcc L8560
                jsr iny8
                bcs L8573

L859B:
                ldy L00AB
                lda LC008,y
                ora #$80
                sta LC008,y
                lda LC267
                cmp L00AA
                beq L85BC
                ldx L00AA
                sta L00AA
                bne L85BC
                jsr LA7DD

L85B5:
                jsr LA7DD
                ldy #$FF
                bne L85C5

L85BC:
                ldy L00A8
                bne L85B5
                ldy #5
                jsr yspace

L85C5:
                iny
                sty L00A8
                ldy L00AB
                jsr LADCF
                jsr prtnam
                jmp L8543

;-------------------------------------------------------------------------

aOff:           .text "off"
                .byte 0
aLoad:          .text "LOAD"
aRun:           .text "RUN"
                .byte 0
aExec:          .text "EXEC"

;-------------------------------------------------------------------------

L85E3:
                lda LC10E,y
                jsr L81B0
                sta L00C2
                clc
                lda #$FF
                adc LC10C,y
                lda LC10F,y
                adc LC10D,y
                sta L00C3
                lda LC10E,y
                and #3
                adc L00C2
                sta L00C2

;-------------------------------------------------------------------------

L8602:
                sec
                lda LC107,y
                sbc L00C3
                pha
                lda LC106,y
                and #3
                sbc L00C2
                tax
                lda #0
                cmp L00C0
                pla
                sbc L00C1
                txa

L8619:
                sbc L00C4

rts861B:
                rts

;-------------------------------------------------------------------------

wordb: .macro value
                .byte >(\value)
                .byte <(\value)
                .endmacro
                
comtab:
                .text "ACCESS"
                .wordb cmd_access-1;$89BC
                .byte $32
                .text "BACKUP"
                .wordb cmd_backup-1;$A817
                .byte 4
                .text "COMPACT"
                .wordb cmd_compact-1;$A647
                .byte 7
                .text "COPY"
                .wordb cmd_copy-1;$A863
                .byte $24
                .text "DESTROY"
                .wordb cmd_destroy-1;$874A
                .byte 2
                .text "DIR"
                .wordb cmd_dir-1;$8917
                .byte 6
                .text "DRIVE"
                .wordb cmd_drive-1;$87A4
                .byte 9
                .text "ENABLE"
                .wordb cmd_enable-1;$8B1D
                .byte 0
                .text "FORM"
                .wordb cmd_form-1;$A9BD
                .byte $BA
                .text "FREE"
                .wordb cmd_free-1;$ABF1
                .byte 7
                .text "LIB"
                .wordb cmd_lib-1;$891B
                .byte 6
                .text "MAP"
                .wordb cmd_map-1;$ABF4
                .byte 7
                .text "RENAME"
                .wordb cmd_rename-1;$8B82
                .byte 5
                .text "TITLE"
                .wordb cmd_title-1;$898D
                .byte 8
                .text "VERIFY"
                .wordb cmd_verify-1;$A9B9
                .byte $B
                .text "WIPE"
                .wordb cmd_wipe-1;$8706
                .byte 2
                .wordb L882C-1
                .text "DISC"
                .wordb LA0B0-1;$A0AF
                .byte 0
                .text "DISK"
                .wordb LA0B0-1;$A0AF
                .byte 0
                .wordb rts861B-1;$861a
                .text "DFS"
                .wordb cmd_dfs-1;$9ED0
                .byte 0
                .wordb L9F09-1;$9F08

;-------------------------------------------------------------------------

L86B5:
                jsr L86FC
                ldx #$FD

L86BA:
                tya
                pha

L86BC:
                inx
                inx
                pla
                pha
                tay
                jsr L8703
                inx
                lda comtab,x    ; "ACCESS"
                bmi L86F2
                dex
                dey
                stx L00BE+1

L86CE:
                inx
                iny
                lda comtab,x    ; "ACCESS"
                bmi L86EB

L86D5:
                eor ($F2),y
                and #$5F
                beq L86CE
                dex

L86DC:
                inx
                lda comtab,x    ; "ACCESS"
                bpl L86DC
                lda ($F2),y
                cmp #'.'
                bne L86BC
                iny
                bcs L86F2

L86EB:
                lda ($F2),y
                jsr L832F
                bcc L86BC

L86F2:
                pla
                lda comtab,x    ; "ACCESS"
                pha
                lda comtab+1,x
                pha
                rts

;-------------------------------------------------------------------------

L86FC:
                stx L00F2
                sty L00F3
                ldy #0
                rts

;-------------------------------------------------------------------------

L8703:
                clc
                jmp GSINIT

;-------------------------------------------------------------------------

cmd_wipe:
                jsr LA4A7
                jsr L9F15
                jsr L821C

L8710:
                lda LC00F,y
                bmi L8733
                jsr prtnam
                jsr LA7E5
                bne L8730
                ldx L00B6
                jsr L9638
                stx L00B6
                jsr L879A
                sty L00AB
                jsr L942B
                lda L00AB
                sta L00B6

L8730:
                jsr LA7DD

L8733:
                jsr L828A
                bcs L8710
                rts

;-------------------------------------------------------------------------

                jsr LA49E
                jsr L9F15
                jsr L821C
                jsr L833D
                jsr L8312
                jmp L942B

;-------------------------------------------------------------------------

cmd_destroy:
                jsr LA719
                jsr LA4A7
                jsr L9F15
                jsr L821C

L8757:
                lda LC00F,y
                bmi L8762
                jsr prtnam
                jsr LA7DD

L8762:
                jsr L828A
                bcs L8757
                jsr LA7ED
                beq L876F
                jmp LA7DD

;-------------------------------------------------------------------------

L876F:
                jsr L9638
                jsr lookup

L8775:
                lda LC00F,y
                bmi L877D
                jsr L879A

L877D:
                jsr L828A
                bcs L8775
                jsr L942B
                jsr vstrng
                .byte $D
                .text "Deleted"
                .byte $D

iny8:
                iny

;-------------------------------------------------------------------------

iny7:
                iny
                iny
                iny
                iny
                iny
                iny
                iny
                rts

;-------------------------------------------------------------------------

L879A:
                jsr L8312
                ldy L00B6
                jsr L82BA
                sty L00B6
                rts

;-------------------------------------------------------------------------

cmd_drive:
                jsr L9F15
                jsr L8B62
                sta LC2CA
                jsr L8458
                beq rts87CC
                cmp #$28
                beq L87BF
                cmp #$50
                clc
                beq L87BF
                jmp L9F1A

;-------------------------------------------------------------------------

L87BF:
                php
                ldx LC2CA
                lda LC2DE,x
                rol a
                plp
                ror a
                sta LC2DE,x

rts87CC:
                rts

;-------------------------------------------------------------------------

L87CD:
                and #3
                sta L00CD
                rts

;-------------------------------------------------------------------------

L87D2:
                jsr L8221
                jsr LA57D
                jsr L838E
                lda #$80

;-------------------------------------------------------------------------

L87DD:
                sta LC296
                sty L00BA
                ldx #0
                lda L00BE
                bne L87EE
                iny
                iny
                ldx #2
                bne L87F6

L87EE:
                lda LC10E,y
                sta L00C2
                jsr L8B24

L87F6:
                lda LC108,y
                sta L00BC,x
                iny
                inx
                cpx #8
                bne L87F6
                jsr L8B3B
                ldy L00BA
                jsr L833D
                jmp L881E

;-------------------------------------------------------------------------

L880C:
                lda #$80
                bne L881B
L8810:
                jsr L8A4E
                jsr LA57D
                jsr L838E

;-------------------------------------------------------------------------

L8819:
                lda #$A0

L881B:
                sta LC296

L881E:
                stz L00B2

L8820:
                jsr L81C9
                jsr L948C
                lda #1
                rts

;-------------------------------------------------------------------------

L8829:
                jsr L86FC
L882C:
                jsr L884B
                bcs L887F
                lda #$B
                jmp L8020

;-------------------------------------------------------------------------

L8836:
                jsr L86FC
                jsr L884B
                bcs L887F
                jsr brk_with_prefix_Bad

;-------------------------------------------------------------------------

aCommand:
                .byte $fe
                .text "command "

;-------------------------------------------------------------------------

                brk

;-------------------------------------------------------------------------

L884B:
                jsr L890B
                sty LC2DA
                jsr L80F3
                sty LC2D9
                jsr L8270
                bcs rts887E
                ldy LC2DA
                lda LC2CB
                sta L00CC
                lda LC2CC
                jsr L87CD
                jsr L80F6
                jsr L8270
                bcs rts887E
                lda L00F2
                adc LC2DA
                tax
                ldy L00F3
                bcc L887D
                iny

L887D:
                clc

rts887E:
                rts

;-------------------------------------------------------------------------

L887F:
                lda LC10E,y
                jsr isoexe
                cmp #3
                bne L88CD
                lda LC10A,y
                and LC10B,y
                cmp #$FF
                bne L88CD
                ldx #6

L8895:
                lda LC200,x
                sta LC207,x
                dex
                bpl L8895
                lda #$D
                sta LC20E
                lda #$45
                sta LC200
                lda #$2E
                sta LC201
                lda #$3A
                sta LC202
                lda L00CD
                ora #$30
                sta LC203
                lda #$2E
                sta LC204
                sta LC206
                lda L00CC
                sta LC205
                ldx #0
                ldy #$C2
                jmp OSCLI

;-------------------------------------------------------------------------

L88CD:
                lda #$81
                jsr L87DD
                clc
                lda LC2D9
                tay
                adc L00F2
                sta LC2D9
                lda L00F3
                adc #0
                sta LC2DA
                lda LC276
                and LC277
                ora LC2D6
                cmp #$FF
                beq L8906
                lda L00BE
                sta LC274
                lda L00BE+1
                sta LC275
                jsr L8F94
                ldx #<LC274
                ldy #>LC274
                lda #4
                jmp $406

;-------------------------------------------------------------------------

L8906:
                lda #1
                jmp (L00BE)

;-------------------------------------------------------------------------

L890B:
                lda #$FF
                sta L00BE
                lda L00F2
                sta L00BA
                lda L00F3
                sta L00BB
                rts

;-------------------------------------------------------------------------

cmd_dir:
                ldx #0
                beq L891E
cmd_lib:
                ldx #2

L891E:
                jsr L8950
                sta LC2CA,x
                lda L00CC
                sta LC2C9,x
                rts

;-------------------------------------------------------------------------

L892A:
                jsr savita
                lda L00B0
                pha
                lda L00B1
                pha
                jsr LA5AE
                ldy #0

L8938:
                cpy #$C0
                bcc L8941
                lda LC200,y
                bcs L8944

L8941:
                lda LC300,y

L8944:
                sta (L00B0),y
                iny
                bne L8938
                pla
                sta L00B1
                pla
                sta L00B0
                rts

;-------------------------------------------------------------------------

L8950:
                lda LC2C9
                sta L00CC
                jsr L8703
                bne L8961
                lda #0
                jsr L87CD
                beq L898B

;-------------------------------------------------------------------------

L8961:
                lda LC2CA
                jsr L87CD

L8967:
                jsr L8149
                bcs L897C
                cmp #':'
                bne L8984
                jsr L8B62
                jsr L8149
                bcs L898B
                cmp #'.'
                beq L8967

L897C:
                jsr brk_with_prefix_Bad

;-------------------------------------------------------------------------

                .byte $CE
aDir:           .text "dir"
                .byte 0

;-------------------------------------------------------------------------

L8984:
                sta L00CC
                jsr L8149
                bcc L897C

L898B:
                lda L00CD
                rts

;-------------------------------------------------------------------------

cmd_title:
                jsr L9F15
                jsr L8B52
                jsr L8388
                ldx #$B
                lda #0

L899B:
                jsr L89B1
                dex
                bpl L899B

L89A1:
                inx
                jsr L8149
                bcs L89AE
                jsr L89B1
                cpx #$B
                bcc L89A1

;-------------------------------------------------------------------------

; Attributes: thunk

L89AE:
                jmp L942B

;-------------------------------------------------------------------------

L89B1:
                cpx #8
                bcc L89B9
                sta LC0F8,x
                rts

;-------------------------------------------------------------------------

L89B9:
                sta LC000,x
                rts

;-------------------------------------------------------------------------

cmd_access:
                jsr LA4A7
                jsr L9F15
                jsr L80ED
                ldx #0
                jsr L8703
                bne L89F0

L89CD:
                stx L00AA
                jsr lookup
                bcs L89D7
                jmp L8229

;-------------------------------------------------------------------------

L89D7:
                jsr LA55E
                lda LC00F,y
                and #$7F
                ora L00AA
                sta LC00F,y
                jsr L833D
                jsr L828A
                bcs L89D7
                bcc L89AE

L89EE:
                ldx #$80

L89F0:
                jsr L8149
                bcs L89CD
                and #$5F
                cmp #'L'
                beq L89EE
                jsr brk_with_prefix_Bad

;-------------------------------------------------------------------------

                .byte $CF
aAttribute:     .text "attribute"
                .byte 0

;-------------------------------------------------------------------------

L8A09:
                jsr savita
                txa
                cmp #4
                beq L8A2B
                cmp #2
                bcc L8A20
                jsr brk_with_prefix_Bad

;-------------------------------------------------------------------------

                .byte $CB
aOption:        .text "option"
                .byte 0

;-------------------------------------------------------------------------

L8A20:
                ldx #$FF
                tya
                beq L8A27
                ldx #0

L8A27:
                stx LC2C6
                rts

;-------------------------------------------------------------------------

L8A2B:
                tya
                pha
                jsr L8B52
                jsr L9451
                pla
                jsr L81C4
                eor LC106
                and #$30
                eor LC106
                sta LC106
                jmp L942B

;-------------------------------------------------------------------------

L8A45:
                jsr brk_with_Prefix_Disc

;-------------------------------------------------------------------------

aFull:
                .byte $c6
                .text "full"
                .byte 0

;-------------------------------------------------------------------------

L8A4E:
                jsr L80F3
                jsr lookup
                bcc L8A59
                jsr L8312

L8A59:
                lda L00C0
                pha
                lda L00C1
                pha
                sec
                lda L00C2
                sbc L00C0
                sta L00C0
                lda L00C3
                sbc L00C1
                sta L00C1
                lda LC27A
                sbc LC278
                sta L00C4

L8A74:
                jsr L8A8A
                lda LC279
                sta LC275
                lda LC278
                sta LC274
                pla
                sta L00BD
                pla
                sta L00BC
                rts

;-------------------------------------------------------------------------

L8A8A:

                lda #0
                sta L00C2
                lda #2
                sta L00C3
                ldy LC105
                cpy #$F8
                bcs L8AEF
                jsr L8602
                jmp L8AA7

;-------------------------------------------------------------------------

L8A9F:
                beq L8A45
                jsr L82BA
                jsr L85E3

L8AA7:
                tya
                bcc L8A9F
                sty L00B0
                ldy LC105

L8AAF:
                cpy L00B0
                beq L8AC2
                lda LC007,y
                sta LC00F,y
                lda LC107,y
                sta LC10F,y
                dey
                bcs L8AAF

L8AC2:
                ldx #0
                jsr L8AFC

L8AC7:
                lda L00C5,x
                sta LC008,y
                iny
                inx
                cpx #8
                bne L8AC7

L8AD2:
                lda L00BB,x
                dey
                sta LC108,y
                dex
                bne L8AD2
                jsr L833D
                tya
                pha
                ldy LC105
                jsr iny8
                sty LC105
                jsr L942B
                pla
                tay
                rts

;-------------------------------------------------------------------------

L8AEF:
                jsr estrng

;-------------------------------------------------------------------------

                .byte $BE
aCatFull:       .text "Cat full"
                .byte 0

;-------------------------------------------------------------------------

L8AFC:
                lda LC276
                and #3
                asl a
                asl a
                eor L00C4
                and #$FC
                eor L00C4
                asl a
                asl a
                eor LC274
                and #$FC
                eor LC274
                asl a
                asl a
                eor L00C2
                and #$FC
                eor L00C2
                sta L00C2
                rts

;-------------------------------------------------------------------------

cmd_enable:
                lda #1
                sta LC2C7
                rts

;-------------------------------------------------------------------------

L8B24:
                lda #0
                sta LC275
                lda L00C2
                jsr L81B6
                cmp #3
                bne L8B37
                lda #$FF
                sta LC275

L8B37:
                sta LC274
                rts

;-------------------------------------------------------------------------

L8B3B:
                lda #0
                sta LC277
                lda L00C2
                jsr isoexe
                cmp #3
                bne L8B4E
                lda #$FF
                sta LC277

L8B4E:
                sta LC276
                rts

;-------------------------------------------------------------------------

L8B52:
                lda LC2C9
                sta L00CC

L8B57:
                lda LC2CA
                jmp L87CD

;-------------------------------------------------------------------------

L8B5D:
                jsr L8703
                beq L8B57

;-------------------------------------------------------------------------

L8B62:
                jsr L8149
                bcs L8B79
                cmp #':'
                beq L8B62
                sec
                sbc #'0'
                bcc L8B79
                cmp #4
                bcs L8B79
                jsr L87CD
                clc
                rts

;-------------------------------------------------------------------------

L8B79:
                jsr brk_with_prefix_Bad

;-------------------------------------------------------------------------

                .byte $CD
aDrive:         .text "drive"
                .byte 0

;-------------------------------------------------------------------------

cmd_rename:
                jsr LA49E
                jsr L9F15
                jsr L80ED
                tya
                pha
                jsr L8224
                jsr LA55B
                sty L00C4
                pla
                tay
                jsr L9F15
                lda L00CD
                pha
                jsr L80ED
                pla
                cmp L00CD
                bne L8B79
                jsr lookup
                bcc L8BBA
                cpy L00C4
                beq L8BBA
                jsr estrng

;-------------------------------------------------------------------------

                .byte $C4
aExists:        .text "Exists"
                .byte 0

;-------------------------------------------------------------------------

L8BBA:
                ldy L00C4
                jsr iny8
                ldx #7

L8BC1:
                lda L00C5,x
                sta LC007,y
                dey
                dex
                bpl L8BC1
                jmp L942B

;-------------------------------------------------------------------------

L8BCD:
                lda #1
                sta L00B2

;-------------------------------------------------------------------------

L8BD1:
                cli
                stx L00B0
                sty L00B1
                cld
                jsr L8C3A
                lda L00A2
                bne L8BE7
                ldy #5
                lda (L00B0),y
                beq L8BE7
                jsr L8CE9

L8BE7:
                ldy #5
                lda (L00B0),y
                clc
                adc #7
                tay
                lda L00A2
                jsr L8C2B
                sta (L00B0),y
                ldx L00A7
                cpx #$80
                bne L8C03
                lda fdccmd
                and #$20
                ora (L00B0),y

L8C03:
                pha
                and #$DF
                cmp #$18
                bne L8C0F
                lda #$FF
                sta LC287

L8C0F:
                lda L00CD
                and #1
                tay
                lda L00CE
                sta LC288,y
                jsr L8F42
                bit L00A1
                bpl L8C23
                jsr L8FA3

L8C23:
                jsr L8F87
                lda fdcdat
                pla
                rts

;-------------------------------------------------------------------------

L8C2B:
                ldx #5

L8C2D:
                cmp L917E,x
                beq L8C36
                dex
                bpl L8C2D
                rts

;-------------------------------------------------------------------------

L8C36:
                lda L9184,x
                rts

;-------------------------------------------------------------------------

L8C3A:
                jsr L8F67
                jsr L8FAB
                stz L00A1
                ldy #9

L8C44:
                lda (L00B0),y
                sta L00AA,y
                iny
                cpy #$C
                bne L8C44
                ldy #6
                lda (L00B0),y
                and #$F0
                cmp #$A0
                beq L8C5A
                cmp #$F0

L8C5A:
                ror L00A1
                ldy #3
                lda (L00B0),y
                iny
                and (L00B0),y
                cmp #$FF
                clc
                beq L8C85
                jsr L8F57
                clc
                bmi L8C85
                jsr L8F94
                lda L00A1
                rol a
                rol a
                and #1
                eor #1
                ldx L00B0
                ldy L00B1
                inx
                bne L8C81
                iny

L8C81:
                jsr $406
                sec

L8C85:
                ror L00A1
                jsr L8FB8
                lda (L00B0)
                bmi L8C92
                and #$F
                sta L00CD

L8C92:
                lda L00CD
                and #3
                tax
                lda LC2DE,x
                sta LC28A
                lda L00CD
                ldy #$A
                and #8
                beq L8CA7
                ldy #$10

L8CA7:
                sty L00A3
                eor L9160,x
                sta LFE24
                lsr a
                ldx LC288
                bcs L8CB8
                ldx LC289

L8CB8:
                stz L00A2
                lda LC287
                bit LC287
                bcc L8CCB
                bpl L8CDC
                stz LC288
                and #$7F
                bpl L8CD2

L8CCB:
                bvc L8CDC
                stz LC289
                and #$BF

L8CD2:
                sta LC287
                lda #0
                jsr L8DE0
                ldx #0

L8CDC:
                txa
                sta L00CE
                jsr L8F42

rts8CE2:
                rts

;-------------------------------------------------------------------------

L8CE3:
                jmp L8EC7

;-------------------------------------------------------------------------

L8CE6:
                jmp L8DE0

;-------------------------------------------------------------------------

L8CE9:

                jsr L8F17
                bne rts8CE2
                ldy #6
                lda (L00B0),y
                cmp #$10
                beq rts8CE2
                cmp #$C0
                beq L8CE3
                cmp #$E0
                bcs L8CE6
                ldy #8
                lda (L00B0),y
                lsr L00B2
                bcs L8D62
                ldx L00B5
                beq L8D10
                inc L00B3
                bne L8D10
                inc L00B4

L8D10:
                jsr L913E
                sta L00CF
                sbc L00A3
                eor #$FF
                inc a
                sta L00A5
                lda L00B4
                bne L8D44
                lda L00B3
                beq rts8D61
                cmp L00A5
                beq L8D2A
                bcs L8D44

L8D2A:
                sta L00A5
                ldx L00B5
                beq L8D44
                stx L00A6
                ror L00A1
                sec
                rol L00A1
                cmp #1
                bne L8D44
                lda intnmi+$22
                ldx intnmi+$24
                sta $D00,x

L8D44:
                lda L00B3
                sec
                sbc L00A5
                sta L00B3
                lda L00B4
                sbc #0
                sta L00B4
                jsr L8DDC
                bne rts8D61
                lda L00B3
                ora L00B4
                beq rts8D61
                jsr L8EE4
                beq L8D10

rts8D61:
                rts

;-------------------------------------------------------------------------

L8D62:
                jsr L913E
                sta L00CF
                ldy #9
                lda (L00B0),y
                and #$1F
                beq rts8D61
                sta L00A5
                bit L00A1
                bvs L8DDC
                bit LC28A
                bvc L8DDC
                ldx #$33        ; ???

L8D7C:
                lda ecowsp,x
                sta LC200,x
                dex
                bpl L8D7C
                jsr L8D96
                ldx #$33        ; ???

L8D8A:
                lda $C200,x
                sta ecowsp,x
                dex
                bpl L8D8A
                lda L00A2
                rts

;-------------------------------------------------------------------------

L8D96:
                stz L00B4
                lda (L00B0),y
                and #$E0
                bne L8DA0
                lda #$10

L8DA0:
                asl a
                rol L00B4
                asl a
                rol L00B4
                asl a
                rol L00B4
                sta L00B3
                tax
                beq L8DB0
                inc L00B4

L8DB0:
                jsr L9081
                lda #$14
                sta L00B7

L8DB7:
                lda #$E0
                sta L00A2
                sta fdccmd

L8DBE:
                lda L00A2
                bmi L8DBE
                bne rts8DDB
                lda L00A5
                beq L8DD1
                dec L00B7
                bne L8DB7
                lda #$10
                sta L00A2
                rts

;-------------------------------------------------------------------------

L8DD1:
                lda L00B6
                eor #$FB
                beq rts8DDB
                lda #$20
                sta L00A2

rts8DDB:
                rts

;-------------------------------------------------------------------------

L8DDC:
                ldy #6
                lda (L00B0),y

;-------------------------------------------------------------------------

L8DE0:
                tay
                pha
                lda L00A4
                lsr a
                beq L8E1F
                bcs L8E1F
                pla
                pha
                cmp #$20
                bcs L8E1F
                cmp #$10
                bcc L8E09
                lda fdcdat
                pha

L8DF7:
                pla
                cmp fcdtrk
                beq L8E1F
                pha
                lda #$50
                bcs L8E04
                lda #$70

L8E04:
                jsr L8DE0
                bra L8DF7

;-------------------------------------------------------------------------

L8E09:
                lda fcdtrk
                sta fdcdat
                lda #$10
                bra L8E15

;-------------------------------------------------------------------------

L8E13:
                lda #$60

L8E15:
                jsr L8DE0
                lda fdccmd
                bit #4
                beq L8E13

L8E1F:
                pla
                ldy #$FF

L8E22:
                iny
                cmp L9164,y
                bne L8E22
                pha
                lda L9171,y
                sta intnmi+5
                ror L00A2
                pla
                bpl L8E8A
                sta L00A7
                ldy #1
                cmp #$C0
                beq L8E55
                ora #4
                bcs L8E55
                ldy L00A5
                cmp #$85
                beq L8E4F
                cmp #$87
                bne L8E55
                lda #$14
                sta intnmi+$43

L8E4F:
                lda #$80
                sta L00A7
                lda #$84

L8E55:
                sty L00A5
                sta fdccmd
                cmp #$F0
                bcc L8E66
                jsr L8EB7
                and #$5C
                sta L00A2
                rts

;-------------------------------------------------------------------------

L8E66:
                lda L00A2
                bmi L8E66
                cmp #$20
                bne L8E71
                jsr L8EBD

L8E71:
                lda L00A7
                bmi L8E87
                cmp #$20
                bcc L8E87
                and #3
                cmp #2
                bne L8E87
                ldy #$30

L8E81:
                dec a
                bne L8E81
                dey
                bne L8E81

L8E87:
                lda L00A2
                rts

;-------------------------------------------------------------------------

L8E8A:
                ldy #1
                sty L00A5
                ora L00A4
                sta L00A7
                sta fdccmd
                tay
                lda L00B2
                lsr a
                bcs L8E66
                cpy #$20
                bcs L8E66

L8E9F:
                lda L00A2
                bpl rts8EB6
                lda L00FF
                bpl L8E9F
                lda #$40
                sta intnmi
                stz LFE24
                lda L00FF
                sta LC282
                sta L00A2

rts8EB6:
                rts

;-------------------------------------------------------------------------

L8EB7:
                lda fdccmd
                ror a
                bcc L8EB7

;-------------------------------------------------------------------------

L8EBD:
                lda fdccmd
                ror a
                bcs L8EBD
                lda fdccmd
                rts

;-------------------------------------------------------------------------

L8EC7:
                lda #$14
                sta intnmi+$54
                ldx intnmi+$43

L8ECF:
                sbc #1
                bne L8ECF
                stx intnmi+$43
                lda #4
                sta L00A6
                jsr L8DDC
                bne rts8EE3
                dec L00B3
                bne L8ECF

rts8EE3:
                rts

;-------------------------------------------------------------------------

L8EE4:
                jsr L8F04
                bne rts8F03
                lda L00CD
                and #1
                asl a
                tay
                lda L00CE
                bit LC28A
                bpl L8EF7
                lsr a

L8EF7:
                cmp LC28B,y
                beq L8EE4
                cmp LC28C,y
                beq L8EE4
                lda #0

rts8F03:
                rts

;-------------------------------------------------------------------------

L8F04:
                bit LC28A
                bpl L8F10
                lda #$40
                jsr L8F12
                bne rts8F03

L8F10:
                lda #$50

;-------------------------------------------------------------------------

L8F12:
                inc L00CE
                jmp L8DE0

;-------------------------------------------------------------------------

L8F17:
                lda L00CD
                and #1
                asl a
                tax
                ldy #7
                lda (L00B0),y
                jsr L8F4B
                bit LC28A
                bpl L8F2A
                asl a

L8F2A:
                sta L00CE
                tay
                beq L8F39

L8F2F:
                sta fdcdat
                cmp fdcdat
                bne L8F2F
                lda #$10

L8F39:
                jsr L8DE0
                bne rts8F56
                ldy #7
                lda (L00B0),y

;-------------------------------------------------------------------------

L8F42:
                sta fcdtrk
                cmp fcdtrk
                bne L8F42
                rts

;-------------------------------------------------------------------------

L8F4B:
                jsr L8F4F
                inx

;-------------------------------------------------------------------------

L8F4F:
                cmp LC28B,x
                bcc rts8F56
                adc #0

rts8F56:
                rts

;-------------------------------------------------------------------------

L8F57:
                lda #$EA
                ldx #0
                ldy #$FF
                jsr OSBYTE
                txa
                eor #$FF
                sta LC2D6
                rts

;-------------------------------------------------------------------------

L8F67:
                ldx #2

L8F69:
                lda L00B0,x
                pha
                dex
                bpl L8F69
                lda #$8F
                ldx #$C
                ldy #$FF
                jsr OSBYTE
                pla
                sta L00B0
                pla
                sta L00B1
                pla
                sta L00B2
                sty L00A0
                inc LC2D3
                rts

;-------------------------------------------------------------------------

L8F87:
                ldy L00A0
                lda #$8F
                ldx #$B
                jsr OSBYTE
                dec LC2D3
                rts

;-------------------------------------------------------------------------

L8F94:
                pha

L8F95:
                lda #$C1        ; claimant code=1
                jsr $406
                bcc L8F95
                pla
                rts

;-------------------------------------------------------------------------

L8F9E:
                jsr L8F57
                bmi rts8FAA

;-------------------------------------------------------------------------

L8FA3:
                pha
                lda #$81        ; claimant code=1
                jsr $406
                pla

rts8FAA:
                rts

;-------------------------------------------------------------------------

L8FAB:
                lda #$A1
                ldx #$B
                jsr OSBYTE
                tya
                and #3
                sta L00A4
                rts

;-------------------------------------------------------------------------

L8FB8:
                ldx #$59

L8FBA:
                lda L9011,x
                sta intnmi,x
                dex
                bpl L8FBA
                ldx #$B
                bit L00A1
                bvc L8FE7
                lda #$3D
                sta intnmi+$56
                lda #6
                bit L00B2
                bmi L8FD7
                sta intnmi+$54

L8FD7:
                stz intnmi+$22
                ldx #$16

L8FDC:
                lda rts906A,x
                sta intnmi+$38,x
                dex
                bne L8FDC
                bra L8FF4

;-------------------------------------------------------------------------

L8FE7:
                bit L00B2
                bvc L8FF4
                ldy LC2C2
                lda seqbuf,y
                sta intnmi+$3E

L8FF4:
                bit L00A1
                bmi L9006
                ldy #1
                lda (L00B0),y
                sta intnmi+$3A,x
                iny
                lda (L00B0),y
                sta intnmi+$3B,x
                rts

;-------------------------------------------------------------------------

L9006:
                lda #$80
                sta intnmi+$47
                lda #6
                sta intnmi+$48
                rts

;-------------------------------------------------------------------------

L9011:
                pha
                lda fdccmd
                and #$18
                cmp #3
                beq L904A
                and #$FC
                bne L9023
                dec L00A5
                bne L9027

L9023:
                sta L00A2
                pla
                rti

;-------------------------------------------------------------------------

L9027:
                lda L00A5
                cmp #1
                bne L9037
                lda L00A1
                ror a
                bcc L9037
                lda #$14
                sta intnmi+$54

L9037:
                inc L00CF
                lda L00CF

L903B:
                sta fdcsec
                cmp fdcsec
                bne L903B
                lda L00A7
                sta fdccmd
                pla
                rti

;-------------------------------------------------------------------------

L904A:
                lda fdcdat
                sta $ff00
                inc intnmi+$3D
                bra L9055

L9055:
                sta LFEE5
                inc intnmi+$45
                bne L9060
                inc intnmi+$46

L9060:
                dec L00A6
                bne L9069
                lda #0
                sta intnmi+$43

L9069:
                pla

rts906A:
                rti

;-------------------------------------------------------------------------

                lda LFEE5
                bra L9076

;-------------------------------------------------------------------------

                stz fdcdat
                pla
                rti

;-------------------------------------------------------------------------

                nop

L9076:
                sta fdcdat
                inc intnmi+$3A
                bne L9081
                inc intnmi+$3B

;-------------------------------------------------------------------------

L9081:
                ldx intnmi+$45
                lda intnmi+$46
                pha
                ldy #$94

L908A:
                lda rts90A9,y

L908D:
                sta intnmi-1,y
                dey
                bne L908A
                pla
                bit L00A1
                bpl L90A3
                lda #$B0
                sta intnmi+$18
                lda #6
                sta intnmi+$19
                rts

;-------------------------------------------------------------------------

L90A3:
                stx intnmi+$16
                sta intnmi+$17

rts90A9:
                rts

;-------------------------------------------------------------------------

                pha
                lda fdccmd
                and #$1B
                cmp #3
                bne L90B9
                lda fdcdat
                bcs L90DF

L90B9:
                and #$FC
                sta L00A2
                pla
                rti

;-------------------------------------------------------------------------

                sta LFEE5
                inc intnmi+$16
                bne L90CA
                inc intnmi+$17

L90CA:
                dec L00A6
                bne L90DD
                dec L00A7
                bne L90DD
                lda #$77
                dec L00A5
                bne L90DA
                lda #$24

L90DA:
                sta intnmi+$E

L90DD:
                pla
                rti

;-------------------------------------------------------------------------

L90DF:
                cmp #$FE
                beq L90E7
                cmp #$CE
                bne L90DD

L90E7:
                lda #$32
                bne L90DA
                sbc fdcdat
                sta L00B5
                lda #$3B
                bne L90DA
                lda #$3F
                bne L90DA
                sbc L00CF
                ora L00B5
                sta L00B5
                lda #$49
                bne L90DA
                lda #$4D
                bne L90DA
                lda L00B3
                sta L00A6
                lda #$55
                bne L90DA
                lda L00B4
                sta L00A7
                lda #$5D
                bne L90DA
                cmp #$FB
                beq L911E
                cmp #$F8
                bne L90DD

L911E:
                sta L00B6
                lda L00B5
                bne L912A
                inc L00CF
                lda #6
                bne L90DA

L912A:
                inc L00A5
                lda #$11
                bne L90DA
                lda #$7B
                bne L90DA
                lda #$7F
                bne L90DA
                bne L90DD
                lda #$26
                bne L90DA

;-------------------------------------------------------------------------

L913E:
                sta fdcsec
                cmp fdcsec
                bne L913E
                rts

;-------------------------------------------------------------------------

                ldx #0
                lda #$5A

L914B:
                sta fcdtrk
                cmp fcdtrk
                beq L9158
                dex
                bne L914B

L9156:
                clc
                rts

;-------------------------------------------------------------------------

L9158:
                lda LFE24
                and #3
                beq L9156
                rts

;-------------------------------------------------------------------------

; Looks like L90D1 from DFS 2.24
L9160:       .byte $25; %
                .byte $26       ; &
                .byte $35       ; 5
                .byte $36       ; 6
L9164:       .byte 0
                .byte $10
                .byte $40       ; @
                .byte $50       ; P
                .byte $70       ; p
                .byte $80       ;
                .byte $81       ;
                .byte $83       ;
                .byte $A0       ;
                .byte $A1       ;
                .byte $C0       ;
                .byte $E0       ;
                .byte $F0       ;
L9171:       .byte $18
                .byte $18
                .byte $18
                .byte $18
                .byte $18
                .byte $3F       ; ?
                .byte $1F
                .byte $1F
                .byte $5F       ; _
                .byte $5F       ; _
                .byte $17
                .byte $1B
                .byte $5F       ; _
L917E:       .byte 8
                .byte $10
                .byte $18
                .byte $20
                .byte $40       ; @
                .byte 0
L9184:       .byte $E
                .byte $18
                .byte $C
                .byte $20
                .byte $12
                .byte 0
L918A:       .byte $B2
L918B:       .byte $91
                .byte $8E       ;
                .byte $91       ;
                .byte $3C       ; <
                .byte $C
                .byte 3
                .byte 1
                .byte 1
                .byte 1
                .byte 1
                .byte 1
                .byte 1
                .byte $16
                .byte $C
                .byte 3
                .byte 1
                .byte $FF
                .byte 1
                .byte 1
                .byte $18
                .byte 4
                .byte $4E       ; N
                .byte 0
                .byte $F5       ;
                .byte $FE       ;
                .byte 0
                .byte 0
                .byte 0
                .byte 0
                .byte $F7       ;
                .byte $4E       ; N
                .byte 0
                .byte $F5       ;
                .byte $FB       ;
                .byte $5A       ; Z
                .byte $5A       ; Z
                .byte $F7       ;
                .byte $4E       ; N
                .byte $4E       ; N
                .byte $10
                .byte 6
                .byte 0
                .byte 1
                .byte 1
                .byte 1
                .byte 1
                .byte 1
                .byte 1
                .byte $B
                .byte 6
                .byte 0
                .byte 1
                .byte $FF
                .byte 1
                .byte 1
                .byte $13
                .byte 3
                .byte $FF
                .byte 0
                .byte 0
                .byte $FE       ;
                .byte 0
                .byte 0
                .byte 0
                .byte 0
                .byte $F7       ;
                .byte $FF
                .byte 0
                .byte 0
                .byte $FB       ;
                .byte $E5       ;
                .byte $E5       ;
                .byte $F7       ;
                .byte $FF
                .byte $FF
L91D6:       .byte $A
                .byte $B
                .byte $E
                .byte $F
                .byte $12
                .byte $13
                .byte $16
                .byte $17
                .byte $1B
                .byte $1E
                .byte $1F
                .byte $23       ; #
                .byte $29       ; )
                .byte $20
                .byte $30       ; 0
L91E5:       .byte $A0
                .byte $A0       ;
                .byte $A1       ;
                .byte $A1       ;
                .byte $80       ;
                .byte $80       ;
                .byte $81       ;
                .byte $81       ;
                .byte $C0       ;
                .byte $83       ;
                .byte $83       ;
                .byte $F0       ;
                .byte $10
                .byte $E0       ;
                .byte $F0       ;

;-------------------------------------------------------------------------

L91F4:
                lda #$FF
                sta LC282
                stx L00C7
                sty L00C8
                ldy #$C

L91FF:
                lda (L00C7),y
                sta L00BA,y
                dey
                bpl L91FF
                ldx #$C
                lda L00BE+1
                cmp #$A
                bne L9211
                ldx #$E

L9211:
                lda L00C0
                and #$3F
                cmp #$3A
                beq L9264
                cmp #$3D
                beq L9284
                cmp #$35
                bne L9224
                jmp L929F

;-------------------------------------------------------------------------

L9224:
                cmp L91D6,x
                beq L9230
                dex
                bpl L9224

L922C:
                lda #$FE
                bmi L9259

L9230:
                cmp #'#'
                beq L9238
                cpx #4
                bcs L9246

L9238:
                lda L00BA
                bpl L923E
                lda L00CD

L923E:
                and #3
                tay
                lda LC2DE,y
                bmi L922C

L9246:
                ldy L91E5,x
                sty L00C0
                cpy #$F0
                bne L9252
                jsr L92E2

L9252:
                ldx #L00BA
                ldy #0
                jsr L8BCD

L9259:
                pha
                lda L00BE+1
                clc
                adc #7
                tay
                pla
                sta (L00C7),y
                rts

;-------------------------------------------------------------------------

L9264:
                jsr L92CF
                bcs L9270
                lda L00C2
                sta LC28B,x
                bcc L9280

L9270:
                jsr L92BE
                bcc L929C
                lda L00C2
                ldy LC2DE,x
                bpl L927D
                asl a

L927D:
                sta LC288,x

L9280:
                lda #0
                beq L929C

L9284:
                jsr L92CF
                bcs L928E
                lda LC28B,x
                bcc L929C

L928E:
                jsr L92BE
                bcc L929C
                lda LC288,x
                ldy LC2DE,x
                bpl L929C
                lsr a

L929C:
                jmp L9259

;-------------------------------------------------------------------------

L929F:
                lda #$FF
                ldx #0
                ldy L00C1
                cpy #$10
                beq L92AF
                cpy #$18
                bne L92BB
                inx
                inx

L92AF:
                lda L00C2
                sta LC28B,x
                lda L00C3
                sta LC28C,x
                lda #0

L92BB:
                jmp L9259

;-------------------------------------------------------------------------

L92BE:
                ldx #0
                lda L00C1
                cmp #$12
                beq rts92CE
                inx
                cmp #$1A
                beq rts92CE
                lda #$FE
                clc

rts92CE:
                rts

;-------------------------------------------------------------------------

L92CF:
                lda L00C1
                and #$F6
                cmp #$10
                sec
                bne rts92E1
                lda L00C1
                lsr a
                lsr a
                ora L00C1
                and #3
                tax

rts92E1:
                rts

;-------------------------------------------------------------------------

L92E2:
                jsr LA588
                lda L00BB
                sta L00B0
                sta L00B4
                clc
                adc #$80
                sta L00B2
                lda L00BC
                sta L00B1
                php
                jsr L8F57
                bmi L9302
                lda L00BD
                ora L00BE
                cmp #$FF
                bne L9309

L9302:
                lda L00B1
                cmp LC2CF
                bcs L930C

L9309:
                lda LC2CF

L930C:
                plp
                sta L00B5
                adc #0
                sta L00B3
                inc L00B5
                lda L00BA
                bpl L931B
                lda #0

L931B:
                rol a
                rol a
                rol a
                sta LC28A
                ldx #2
                rol a
                bmi L9328
                ldx #0

L9328:
                lda L918A,x
                sta L00B6
                lda L918B,x
                sta L00B7
                ldy #$23

L9334:
                lda (L00B6),y
                sta (L00B2),y
                dey
                bpl L9334
                iny
                sty L00B6
                lda L00C3
                pha
                and #$E0
                bne L9347
                lda #$10

L9347:
                asl a
                rol L00B6
                asl a
                rol L00B6
                asl a
                rol L00B6
                ldy #$D
                sta (L00B2),y
                lda L00B6
                iny
                sta (L00B2),y
                pla
                and #$1F
                sta L00B9
                lda L00C2
                ldy #$10
                sta (L00B2),y
                lda L00C5
                ldy #0
                sta (L00B2),y
                tya
                sta L00B8
                jsr L9418
                jsr L8F57
                bmi L93AC
                lda L00BD
                and L00BE
                cmp #$FF
                beq L93AC
                lda #$FF
                sta L00BD
                sta L00BE
                jsr L8F94
                ldx #L00BB
                ldy #0
                tya
                jsr $406
                ldx L00B5
                dex
                stx L00B1
                lda L00B9
                asl a
                asl a
                tax
                ldy #0

L939A:
                lda #7

L939C:
                sbc #1
                bne L939C
                lda LFEE5
                sta (L00B0),y
                iny
                dex
                bpl L939A
                jsr L8FA3

L93AC:
                lda L00B5
                sta L00BC

L93B0:
                ldy #$16
                ldx #0

L93B4:
                lda (L00B0,x)
                sta (L00B2),y
                inc L00B0
                bne L93BE
                inc L00B1

L93BE:
                iny
                cpy #$1A
                bne L93B4
                lda #1
                sta L00B6

L93C7:
                lda L00B6
                cmp #$E
                bne L93D2
                jsr L93F9
                beq L93D5

L93D2:
                jsr L9418

L93D5:
                inc L00B6
                lda L00B6
                cmp #$11
                bne L93C7
                inc L00B8
                dec L00B9
                bne L93B0
                tay
                lda #$E
                bit LC28A
                bvc L93ED
                lda #$1A

L93ED:
                clc
                adc L00BC
                sbc L00B5
                bcs L93F6
                lda #1

L93F6:
                sta (L00B2),y
                tya

;-------------------------------------------------------------------------

L93F9:
                jsr L940A
                beq rts9409
                stx L00B7
                ldx #0

L9402:
                jsr L941D
                dec L00B7
                bne L9402

rts9409:
                rts

;-------------------------------------------------------------------------

L940A:
                tay
                lda (L00B2),y
                tax
                tya
                clc
                adc #$12
                tay
                lda (L00B2),y
                cpx #0
                rts

;-------------------------------------------------------------------------

L9418:
                jsr L940A
                beq rts942A

;-------------------------------------------------------------------------

L941D:
                ldy #0

L941F:
                sta (L00B4),y
                inc L00B4
                bne L9427
                inc L00B5

L9427:
                dex
                bne L941F

rts942A:
                rts

;-------------------------------------------------------------------------

L942B:
                lda LC104
                clc
                sed
                adc #1
                sta LC104
                cld

L9436:
                ldy #$A0
                bne L9453

;-------------------------------------------------------------------------

L943A:
                ldy #$81
                bne L9453

L943E:
                ldy #$81
                bne L9444

L9442:
                ldy #$80

L9444:
                bit fdccmd
                bpl L9453
                lda LC282
                cmp L00CD
                bne L9453
                rts

;-------------------------------------------------------------------------

L9451:
                ldy #$80

L9453:
                jsr L957D
                sty LC296
                lda L00CD
                sta LC290
                lda #2
                sta LC299
                lda #$C0
                sta LC292
                dec LC293
                dec LC294
                jsr L948A
                lda L00CD
                sta LC282
                rts

;-------------------------------------------------------------------------

L9477:
                bit L00FF
                bpl rts9489

L947B:
                jsr LA5CC
                jsr do_following_brk

;-------------------------------------------------------------------------

aEscape:        .byte $11
                .text "Escape"
                .byte 0

;-------------------------------------------------------------------------

rts9489:
                rts

;-------------------------------------------------------------------------

L948A:
                stz L00B2

;-------------------------------------------------------------------------

L948C:

                jsr L955D
                lda #6
                sta LC29E
                jsr L9477

L9497:
                lda LC297
                ldx LC290
                ldy LC2DE,x
                bpl L94A3
                asl a

L94A3:
                ldy #$18
                cmp #$50
                bcs L9508
                ldx #<LC290
                ldy #>LC290
                jsr L8BD1
                tay
                beq rts9489
                bmi L947B
                cmp #$12
                beq L950D
                cmp #$20
                bne L94D4
                lda LC296
                ror a
                bcs rts9489
                jsr do_following_brk

;-------------------------------------------------------------------------

                .byte $BC
aExecuteOnly:   .text "Execute only"
                .byte 0

;-------------------------------------------------------------------------

L94D4:
                cmp #$18
                bne L9503
                lda LC28A
                cmp #4
                bne L94F0
                ldx LC296
                cpx #$81
                bne L94F0
                lda #$FF
                eor LC28B
                sta LC28B
                bcs L9503

L94F0:
                ldx L00CE
                beq L9503
                rol a
                and #$80
                ldx LC290
                eor LC2DE,x
                sta LC2DE,x
                jsr L955D

L9503:
                dec LC29E
                bne L9497

L9508:
                tya

L9509:
                cmp #$12
                bne L951B

L950D:
                jsr brk_with_Prefix_Disc

;-------------------------------------------------------------------------

aReadOnly:
                .byte $c9
                .text "read only"
                .byte 0

;-------------------------------------------------------------------------

L951B:
                pha
                jsr brk_with_Prefix_Disc
                brk

;-------------------------------------------------------------------------

                nop
                jsr L804F

;-------------------------------------------------------------------------

                .byte $C7
aFault:         .text "fault "

;-------------------------------------------------------------------------

                nop
                pla
                jsr L956D
                jsr L804F
                brk

;-------------------------------------------------------------------------

aAt:            .text " at :"

;-------------------------------------------------------------------------

                lda L00CD
                jsr L9575
                jsr L804F
                brk

;-------------------------------------------------------------------------

                .text " "

;-------------------------------------------------------------------------

                lda L00CE
                bit LC28A
                bpl L954B
                lsr a

L954B:
                jsr L956D
                jsr L804F

;-------------------------------------------------------------------------

                .byte 0
                .byte '/'

;-------------------------------------------------------------------------

                lda L00CF
                jsr L956D
                jsr L804F

;-------------------------------------------------------------------------

                .byte $C7
                .byte 0

;-------------------------------------------------------------------------

L955D:

                lda LC296
                cmp #$A0
                bcc rts957C
                ldx LC290
                lda LC2DE,x
                bmi L950D
                rts

;-------------------------------------------------------------------------

L956D:
                pha
                jsr L81BE
                jsr L9575
                pla

L9575:
                jsr L80C8
                sta L0100,x
                inx

rts957C:
                rts

;-------------------------------------------------------------------------

L957D:
                ldx #$D
                lda #0

L9581:
                sta LC28F,x
                dex
                bne L9581
                lda #5
                sta LC295
                rts

;-------------------------------------------------------------------------

L958D:
                ldx #$11
                ldy #$15

rts9591:
                rts

;-------------------------------------------------------------------------

L9592:
                jsr savita
                lda #$77
                jsr OSBYTE
                jmp LA1F4

;-------------------------------------------------------------------------

                lda #$20
                sta LC286

close2:
                lda #$77
                jsr OSBYTE

;-------------------------------------------------------------------------

L95A7:

                lda #0

L95A9:
                clc
                adc #$20
                beq rts9591
                tay
                jsr L95BF
                bne L95A9

;-------------------------------------------------------------------------

L95B4:

                lda #$20
                sta LC286
                tya
                beq close2
                jsr dcrych

;-------------------------------------------------------------------------

L95BF:
                pha
                jsr L98A7
                bcs L960B
                lda LC31B,y
                eor #$FF
                and LC2C0
                sta LC2C0
                lda LC317,y
                and #$60
                beq L960B
                jsr L9610
                lda LC317,y
                and LC286
                beq L9608
                ldx LC2C3
                lda LC314,y
                sta LC10C,x
                lda LC315,y
                sta LC10D,x
                lda LC316,y
                jsr L81C4
                eor LC10E,x
                and #$30
                eor LC10E,x
                sta LC10E,x
                jsr L942B
                ldy LC2C2

L9608:
                jsr bflush

L960B:
                ldx LC2C5
                pla
                rts

;-------------------------------------------------------------------------

L9610:

                jsr L962B

L9613:
                ldx #6

L9615:
                lda LC30C,y
                sta L00C5,x
                dey
                dey
                dex
                bpl L9615
                jsr L8277
                bcc L9646
                sty LC2C3
                ldy LC2C2

rts962A:
                rts

;-------------------------------------------------------------------------

L962B:
                lda LC30E,y
                and #$7F
                sta L00CC
                lda LC317,y
                jmp L87CD

;-------------------------------------------------------------------------

L9638:
                jsr savita
                lda LC104
                jsr L8388
                cmp LC104
                beq rts962A

L9646:
                jsr brk_with_Prefix_Disc

;-------------------------------------------------------------------------

                .byte $C8
aChanged:       .text "changed"
                .byte 0

;-------------------------------------------------------------------------

L9652:
                and #$C0
                bne L965C
                jsr savita
                jmp L95B4

;-------------------------------------------------------------------------

L965C:
                jsr savit
                stx L00BA
                sty L00BB
                sta L00B4
                bit L00B4
                php
                jsr L80F3
                jsr LA49E
                jsr lookup
                bcs L9697
                plp
                bvc L9679
                lda #0
                rts

;-------------------------------------------------------------------------

L9679:
                php
                lda #0
                ldx #7

L967E:
                sta L00BC,x
                sta LC274,x
                dex
                bpl L967E
                dec L00BE
                dec L00BE+1
                dec LC276

L968D:
                dec LC277
                lda #$40
                sta L00C3
                jsr L8A4E

L9697:
                plp
                php
                bvs L969E
                jsr LA54B

L969E:
                jsr L9764
                bcc L96B1

L96A3:
                lda LC30C,y
                bpl L96C8
                plp
                php
                bmi L96C8
                jsr L975F
                bcs L96A3

L96B1:
                ldy LC2C2
                bne L96D1
                jsr estrng

;-------------------------------------------------------------------------

                .byte $C0
aTooManyOpen:   .text "Too many open"
                .byte 0

;-------------------------------------------------------------------------

L96C8:
                jsr estrng

;-------------------------------------------------------------------------

aOpen:
                .byte $c2
                .text "Open"
                .byte 0

;-------------------------------------------------------------------------

L96D1:
                lda #8
                sta LC2C4

L96D6:
                lda LC008,x
                sta LC300,y
                iny

L96DD:
                lda LC108,x
                sta LC300,y
                iny
                inx
                dec LC2C4
                bne L96D6
                ldx #$10
                lda #0

L96EE:
                sta LC300,y
                iny
                dex
                bne L96EE
                lda LC2C2
                tay
                jsr L81BD
                adc #$C3
                sta seqbuf,y
                lda LC2C1
                sta LC31B,y
                ora LC2C0
                sta LC2C0
                lda LC309,y
                adc #$FF
                lda LC30B,y
                adc #0
                sta LC319,y
                lda LC30D,y
                ora #$F
                adc #0
                jsr L81B0
                sta LC31A,y
                plp
                bvc L9758

L972A:
                bmi L9734
                lda #$80
                ora LC30C,y
                sta LC30C,y

L9734:
                lda LC309,y
                sta LC314,y
                lda LC30B,y
                sta LC315,y
                lda LC30D,y
                jsr L81B0
                sta LC316,y

L9749:
                lda L00CD
                ora LC317,y
                sta LC317,y
                tya
                jsr L81BD
                ora #$10
                rts

;-------------------------------------------------------------------------

L9758:
                lda #$20
                sta LC317,y
                bne L9749

;-------------------------------------------------------------------------

L975F:
                txa
                pha
                jmp L97A3

;-------------------------------------------------------------------------

L9764:
                lda #0
                sta LC2C2
                lda #8
                sta L00B5
                tya
                tax
                ldy #$A0

L9771:
                sty L00B3
                txa
                pha
                lda #8
                sta L00B2
                lda L00B5
                bit LC2C0
                beq L979D
                lda LC317,y
                eor L00CD
                and #3
                bne L97A3

L9789:
                lda LC008,x
                eor LC300,y
                and #$7F
                bne L97A3
                inx
                iny
                iny
                dec L00B2
                bne L9789
                sec
                bcs L97AD

L979D:
                sty LC2C2
                sta LC2C1

L97A3:
                sec
                lda L00B3
                sbc #$20
                sta L00B3
                asl L00B5
                clc

L97AD:
                pla
                tax
                ldy L00B3
                lda L00B5
                bcs rts97B7
                bne L9771

rts97B7:
                rts

;-------------------------------------------------------------------------

L97B8:
                jsr L97D4

;-------------------------------------------------------------------------

L97BB:
                lda LC2C0
                pha
                lda #0
                sta LC286
                tya
                bne L97CC
                jsr L95A7
                beq L97CF

L97CC:
                jsr L95B4

L97CF:
                pla
                sta LC2C0
                rts

;-------------------------------------------------------------------------

L97D4:
                pha
                txa
                pha
                lda #0
                tsx
                sta $109,x
                pla
                tax
                pla
                rts

;-------------------------------------------------------------------------

L97E1:
                jsr savita
                cmp #$FF
                beq L97B8
                cpy #0
                beq L9801
                cmp #4
                bcs rts981A
                jsr L97D4
                cmp #3
                beq L9841
                cmp #1
                bne L9822
                jsr dcrych
                jmp L9AC7

;-------------------------------------------------------------------------

L9801:
                cmp #2
                bcs rts981A
                jsr L97D4
                beq L981B
                lda #$FF
                sta 2,x
                sta 3,x
                lda LC2D9
                sta 0,x
                lda LC2DA
                sta 1,x

rts981A:
                rts

;-------------------------------------------------------------------------

L981B:
                lda #4
                tsx
                sta $105,x
                rts

;-------------------------------------------------------------------------

L9822:
                jsr dcrych
                sty LC2C2
                asl a
                adc LC2C2
                tay
                lda seqpl,y
                sta 0,x
                lda LC311,y
                sta 1,x
                lda LC312,y
                sta 2,x
                lda #0
                sta 3,x
                rts

;-------------------------------------------------------------------------

L9841:
                jsr dcrych
                jsr L99F9
                lda #$20
                jsr L99B2
                ldy LC2C2
                lda LC314,y
                cmp 0,x
                lda LC315,y
                sbc 1,x
                lda LC316,y
                sbc 2,x
                lda #0
                sbc 3,x
                bcs L988F
                phx
                phy
                ldx #$FD

L9868:
                lda seqpl,y
                sta LC1A7,x
                iny
                inx
                bne L9868
                ply
                plx
                jsr L9AC7

;-------------------------------------------------------------------------

L9877:
                ldy LC2C2
                phy
                ldx #$FD

L987D:
                lda LC1A7,x
                sta seqpl,y
                iny
                inx
                bne L987D
                dex
                stx LC2A6
                ply
                jmp L9C29

;-------------------------------------------------------------------------

L988F:
                lda 0,x
                sta LC314,y
                lda 1,x
                sta LC315,y
                lda 2,x
                sta LC316,y
                jsr L9AAE
                bcc rts98A6
                jsr L9C1B

rts98A6:
                rts

;-------------------------------------------------------------------------

L98A7:
                pha
                stx LC2C5
                tya
                and #$E0
                sta LC2C2
                beq L98C6
                jsr L81BD
                tay
                lda #0
                sec

L98BA:
                ror a
                dey
                bne L98BA
                ldy LC2C2
                bit LC2C0
                bne L98C9

L98C6:
                pla
                sec
                rts

;-------------------------------------------------------------------------

L98C9:
                pla
                clc
                rts

;-------------------------------------------------------------------------

                pha
                txa
                jmp L98D3

;-------------------------------------------------------------------------

L98D1:
                pha
                tya

L98D3:
                cmp #$10
                bcc L98DB
                cmp #$18
                bcc L98DD

L98DB:
                lda #8

L98DD:
                jsr L81C3
                tay
                pla
                rts

;-------------------------------------------------------------------------

L98E3:
                lda #$C6
                jsr readby
                txa
                beq L98F4
                jsr L9907
                bne L98F4
                lda #$C6
                bne L9900

L98F4:
                lda #$C7
                jsr readby
                jsr L9907
                bne rts990F
                lda #$C7

L9900:
                ldx #0
                ldy #0
                jmp OSBYTE

;-------------------------------------------------------------------------

L9907:
                txa
                tay
                jsr L98D1
                cpy LC2C2

rts990F:
                rts

;-------------------------------------------------------------------------

L9910:
                pha
                tya
                pha
                txa
                tay
                jsr dcrych
                jsr L9AAE
                bne L9921
                ldx #$FF
                bne L9923

L9921:
                ldx #0

L9923:
                pla
                tay
                pla

rts9926:
                rts

;-------------------------------------------------------------------------

dcrych:

                jsr L98D1
                jsr L98A7
                bcc rts9926
                jsr L98E3
                jsr estrng

;-------------------------------------------------------------------------

                .byte $DE
aChannel:       .text "Channel"
                .byte 0

;-------------------------------------------------------------------------

L993E:
                jsr estrng

;-------------------------------------------------------------------------

                .byte $DF
aEof:           .text "EOF"
                .byte 0

;-------------------------------------------------------------------------

L9946:
                jsr savit
                jsr dcrych
                jsr L9AAE
                bne L9964
                lda LC317,y
                and #$10
                bne L993E
                lda #$10
                jsr L99B2
                ldx LC2C5
                lda #$FE
                sec
                rts

;-------------------------------------------------------------------------

L9964:
                lda LC317,y
                bmi L9973
                jsr L962B
                jsr bflush
                sec
                jsr xblock

L9973:
                lda seqpl,y
                sta L00BA
                lda seqbuf,y
                sta L00BB
                ldy #0
                lda (L00BA),y
                pha
                ldy LC2C2
                ldx L00BA
                inx
                txa
                sta seqpl,y
                bne L99A2
                clc
                lda LC311,y

L9992:
                adc #1
                sta LC311,y
                lda LC312,y
                adc #0
                sta LC312,y
                jsr L99B7

L99A2:
                clc
                pla
                rts

;-------------------------------------------------------------------------

setda:
                jsr L9EBD
                sta seqdah,y
                lda L00C3
                sta LC31C,y

L99B0:
                lda #$80

;-------------------------------------------------------------------------

L99B2:
                ora LC317,y
                bne L99BC

;-------------------------------------------------------------------------

L99B7:
                lda #$7F

;-------------------------------------------------------------------------

L99B9:
                and LC317,y

L99BC:
                sta LC317,y
                clc
                rts

;-------------------------------------------------------------------------

bflush:
                lda LC317,y
                and #$40
                beq bflx
                clc

xblock:
                php
                inc LC2DD
                ldy LC2C2
                lda #1
                sta L00C1
                jsr L9C64
                plp
                bcs xblrd
                lda seqdah,y
                sta L00C2
                jsr L8819
                ldy LC2C2
                lda #$BF
                jsr L99B9
                bcc xblfin

xblrd:
                jsr setda
                jsr L880C

xblfin:
                dec LC2DD
                ldy LC2C2

bflx:
                rts

;-------------------------------------------------------------------------

L99F9:
                lda LC30C,y
                bmi vbput2
                lda LC30E,y
                bpl bflx
                jmp LA550

;-------------------------------------------------------------------------

vbput2:
                jsr estrng

;-------------------------------------------------------------------------

aReadOnly_0:
                .byte $c1
                .text "Read only"
                .byte 0

;-------------------------------------------------------------------------

                jsr savita
                jmp L9A20

;-------------------------------------------------------------------------

L9A1A:
                jsr savita
                jsr dcrych

L9A20:
                pha
                jsr L99F9
                jsr L962B
                tya
                clc
                adc #4
                jsr pcmp
                bne notful
                jsr L9613
                ldx LC2C3
                sec
                lda LC107,x
                sbc LC10F,x
                pha
                lda LC106,x
                sbc LC10E,x
                and #3
                cmp LC31A,y
                bne L9A6A
                pla
                cmp LC319,y
                bne vokspl
                sty L00B4
                sty LC2C2

L9A56:
                jsr L98E3
                jsr estrng

;-------------------------------------------------------------------------

                .byte $BF
aCanTExtend:    .text "Can"
                .byte $27
                .text "t extend"
                .byte 0

;-------------------------------------------------------------------------

L9A6A:
                lda LC31A,y
                clc
                adc #1
                sta LC31A,y
                asl a
                asl a
                asl a
                asl a
                eor LC10E,x
                and #$30
                eor LC10E,x
                sta LC10E,x
                pla
                lda #0

vokspl:
                sta LC10D,x
                sta LC319,y
                lda #0
                sta LC10C,x
                jsr L942B
                ldy LC2C2

notful:
                jsr L9C4B
                lda seqpl,y
                sta L00BA
                lda seqbuf,y
                sta L00BB
                pla
                ldy #0
                sta (L00BA),y
                ldy LC2C2
                jmp L9E58

;-------------------------------------------------------------------------

L9AAE:
                tya

pcmp:
                tax
                lda LC312,y
                cmp LC316,x
                bne rts9AC6
                lda LC311,y
                cmp LC315,x
                bne rts9AC6
                lda seqpl,y
                cmp LC314,x

rts9AC6:
                rts

;-------------------------------------------------------------------------

L9AC7:

                ldy #$FC

L9AC9:
                lda 0,x
                sta LC1A4,y
                inx
                iny
                bne L9AC9
                lda #1

L9AD4:
                pha
                ldy LC2C2
                jsr L962B
                lda LC2A3
                beq L9AE6
                stz LC2A3
                sty LC2A2

L9AE6:
                jsr L9BEE
                bcs L9B63
                jsr L99F9
                jsr L9BDB
                bcs L9B63
                jsr L9610
                ldx LC2C3
                lda LC107,x
                sec
                sbc LC10F,x
                sta LC319,y
                lda LC106,x
                sbc LC10E,x
                and #3
                sta LC31A,y
                lda #0
                sta LC318,y
                jsr L9BDB
                php
                bcs L9B2A
                stz LC2A0
                lda LC319,y
                sta LC2A1
                lda LC31A,y
                sta LC2A2
                bra L9B46

;-------------------------------------------------------------------------

L9B2A:
                clc
                lda LC2A0
                ora LC2A1
                beq L9B3B
                lda LC31A,y
                cmp LC2A2
                beq L9B46

L9B3B:
                lda #0
                sta LC319,y
                adc LC2A2
                sta LC31A,y

L9B46:
                jsr L81C4
                eor LC10E,x
                and #$30
                eor LC10E,x
                sta LC10E,x
                lda LC319,y
                sta LC10D,x
                stz LC10C,x
                phy
                jsr L942B
                ply
                plp

L9B63:
                pla
                beq rts9BDA
                php
                jsr L9BEE
                bcs L9BCE
                jsr L9C1B
                jsr L9C4B
                lda seqpl,y
                jsr L9C7B
                lda #$40
                jsr L99B2
                sec
                lda LC2A1
                sbc LC315,y
                sta L00C1
                lda LC2A2
                sbc LC316,y
                tax
                ora L00C1
                beq L9BC0
                txa
                jsr L81C4
                ora seqdah,y
                sta L00C2
                jsr L9C64
                lda LC2A0
                beq L9BA4
                dec L00C0

L9BA4:
                lda #$80
                sta L00B2
                lda #$A0
                sta LC296
                jsr L9E9A
                lda #0
                jsr L9C7B
                jsr L9C0C
                jsr setda
                lda #$BF
                jsr L99B9

L9BC0:
                phy
                iny
                iny
                iny
                iny
                jsr L9C0C
                ply
                lda #$20
                jsr L99B2

L9BCE:
                jsr L9C0C
                jsr L9C29
                plp
                bcs rts9BDA
                jmp L9A56

;-------------------------------------------------------------------------

rts9BDA:
                rts

;-------------------------------------------------------------------------

L9BDB:
                lda LC318,y
                cmp LC2A0
                lda LC319,y
                sbc LC2A1
                lda LC31A,y
                sbc LC2A2
                rts

;-------------------------------------------------------------------------

L9BEE:
                lda #0
                cmp LC2A3
                bne rts9C0B
                lda LC316,y
                cmp LC2A2
                bne rts9C0B
                lda LC315,y
                cmp LC2A1
                bne rts9C0B
                lda LC314,y
                cmp LC2A0

rts9C0B:
                rts

;-------------------------------------------------------------------------

L9C0C:
                phy
                ldx #$FD

L9C0F:
                lda LC1A3,x
                sta seqpl,y
                iny
                inx
                bne L9C0F
                ply

rts9C1A:
                rts

;-------------------------------------------------------------------------

L9C1B:
                ldx #2
                phy

L9C1E:
                lda LC314,y
                sta seqpl,y
                iny
                dex
                bpl L9C1E
                ply

;-------------------------------------------------------------------------

L9C29:

                lda #$6F
                jsr L99B9
                lda LC30F,y
                adc LC311,y
                tax
                lda LC30D,y
                and #3
                adc LC312,y
                cmp seqdah,y
                bne rts9C1A
                txa
                cmp LC31C,y
                bne rts9C1A
                jmp L99B0

;-------------------------------------------------------------------------

L9C4B:
                lda LC317,y
                bmi rts9C1A
                jsr bflush
                lda LC314,y
                bne L9C60
                jsr L9AAE
                bne L9C60
                jmp setda

;-------------------------------------------------------------------------

L9C60:
                sec
                jmp xblock

;-------------------------------------------------------------------------

L9C64:
                stz L00BC
                lda seqbuf,y
                sta L00BD
                lda #$FF
                sta LC274
                sta LC275
                stz L00C0
                lda LC31C,y
                sta L00C3
                rts

;-------------------------------------------------------------------------

L9C7B:
                sta L00BA
                lda seqbuf,y
                sta L00BB
                lda #0

L9C84:
                sta (L00BA)
                inc L00BA
                bne L9C84
                rts

;-------------------------------------------------------------------------

L9C8B:
                jsr L9E8C
                ldx #3

L9C90:
                lda LC269,x
                sta LC2A0,x
                dex
                bpl L9C90
                ldy LC260
                jsr dcrych
                jsr L962B
                plp
                bcs L9CAA
                lda #1
                jsr L9AD4

L9CAA:
                ldx #$FC
                phy
                clc

L9CAE:
                lda seqpl,y
                inx
                bne L9CB6
                lda #0

L9CB6:
                dex
                sta LC16D,x
                adc LC169,x
                sta LC1A4,x
                iny
                inx
                bne L9CAE
                ply
                bcc L9CCA
                sty LC2A3

L9CCA:
                sec
                jsr LA35D
                php
                txa
                jsr L9AD4
                php
                ldx #$7C
                sec

L9CD7:
                lda LC2A0-$7C,x
                pha
                sbc LC269-$7C,x
                sta L00C4-$7C,x
                pla
                sta LC269-$7C,x
                lda LC261-$7C,x
                sta L00C8-$7C,x
                inx
                bpl L9CD7
                ldx #$7C
                sec

L9CEF:
                lda LC265-$7C,x
                sbc L00C4-$7C,x
                sta LC265-$7C,x
                inx
                bpl L9CEF
                lda seqpl,y
                beq L9D02
                jsr L9DD1

L9D02:
                lda L00C5
                ora L00C6
                bne L9D0B
                jmp L9D9C

;-------------------------------------------------------------------------

L9D0B:
                jsr bflush
                jsr L99B7
                lda #0
                sta LC31C,y
                sta seqdah,y
                pha
                ldx LC27F
                lda L9DCF,x
                sta LC296
                txa
                bne L9D34
                jsr L9BEE
                bcc L9D33
                beq L9D33
                pla
                lda L00C4
                pha
                stz L00C4

L9D33:
                inx

L9D34:
                lda L00C4,x
                sta L00C0,x
                lda L00C8,x
                sta L00BC,x
                lda L00CA,x
                sta LC274,x
                dex
                bpl L9D34
                jsr L9EBD
                lda #$40
                sta L00B2
                lda L00C6
                jsr L81C4
                tsb L00C2
                jsr L9E9A
                phy
                ldx #$7D
                clc

L9D59:
                lda seqpl,y
                adc L00C4-$7D,x
                sta seqpl,y
                iny
                inx
                bpl L9D59
                ply
                jsr L9E71
                phy
                ldx #$7C
                clc

L9D6D:
                lda L00C8-$7C,x
                adc L00C4-$7C,x
                stz L00C4-$7C,x
                sta L00C8-$7C,x
                sta LC261-$7C,x
                inx
                bpl L9D6D
                ply
                lda LC27F
                beq L9D99
                jsr setda
                lda seqpl,y
                bne L9D99
                jsr L99B7
                tya
                tax
                lda LC31C,x
                bne L9D96
                dec seqdah,x

L9D96:
                dec LC31C,x

L9D99:
                pla
                sta L00C4

L9D9C:
                lda L00C4
                beq L9DA3
                jsr L9DD1

L9DA3:
                plp
                bcs L9DA9
                jmp L9A56

;-------------------------------------------------------------------------

L9DA9:
                ldx #$FC
                phy

L9DAC:
                lda (L00C8-$FC)&$ffff,x
                sta LC165,x
                inx
                bne L9DAC
                jsr LA464
                ldy #$C

L9DBA:
                lda LC260,y
                sta (L00B4),y
                dey
                bpl L9DBA
                ply
                plp
                bcs L9DCD
                lda #$10
                jsr L99B2
                sec
                rts

;-------------------------------------------------------------------------

L9DCD:
                clc
                rts

;-------------------------------------------------------------------------

L9DCF:
                ldy #$80

;-------------------------------------------------------------------------

L9DD1:
                jsr L9C4B
                lda seqbuf,y
                sta L00BB
                lda seqpl,y
                sta L00BA
                phy
                jsr L9E30
                ply

L9DE3:
                ldx #0

L9DE5:
                lda L00C4,x
                bne L9DF0
                inx
                cpx #4
                bcc L9DE5
                bra L9E2A

;-------------------------------------------------------------------------

L9DF0:
                dec L00C4,x
                dex
                bpl L9DF0
                bit LC281
                lda LC27F
                bvs L9E09
                bne L9E03
                lda (L00C8)
                bra L9E0E

;-------------------------------------------------------------------------

L9E03:
                lda (L00BA)
                sta (L00C8)
                bra L9E17

;-------------------------------------------------------------------------

L9E09:
                bne L9E12
                lda LFEE5

L9E0E:
                sta (L00BA)
                bra L9E17

;-------------------------------------------------------------------------

L9E12:
                lda (L00BA)
                sta LFEE5

L9E17:
                ldx #$7C

L9E19:
                inc LC261-$7C,x
                inc L00C8-$7C,x
                bne L9E23
                inx
                bpl L9E19

L9E23:
                jsr L9E53
                lda L00BA
                bne L9DE3

L9E2A:
                phy
                jsr L9E8C
                ply
                rts

;-------------------------------------------------------------------------

L9E30:
                stz LC281
                lda LC263
                and LC264
                ora LC2D6
                inc a
                beq rts9E52
                dec LC281
                jsr L8F94
                lda LC27F
                ldx #<LC261
                ldy #>LC261
                jsr $406
                jsr rts9E52

rts9E52:
                rts

;-------------------------------------------------------------------------

L9E53:
                lda LC27F
                bne L9E5D

L9E58:
                lda #$40
                jsr L99B2

L9E5D:
                tya
                tax
                inc L00BA
                inc seqpl,x
                bne L9E71
                jsr L99B7
                inc LC311,x
                bne L9E71
                inc LC312,x

;-------------------------------------------------------------------------

L9E71:
                jsr L9AAE
                bcc rts9E8B
                beq rts9E8B
                lda #$20
                jsr L99B2
                ldx #2
                phy

L9E80:
                lda seqpl,y
                sta LC314,y
                iny
                dex
                bpl L9E80
                ply

rts9E8B:
                rts

;-------------------------------------------------------------------------

L9E8C:
                bit LC281
                bpl rts9E99
                phy
                jsr L8FA3
                stz LC281
                ply

rts9E99:
                rts

;-------------------------------------------------------------------------

L9E9A:
                phy
                inc LC2DD
                jsr L8820
                dec LC2DD
                ply
                rts

;-------------------------------------------------------------------------

L9EA6:
                jsr L9BEE
                bcs rts9EBC
                phy
                ldx #$FD

L9EAE:
                lda LC314,y
                sta LC2A0-$FD,x
                iny
                inx
                bne L9EAE
                stz LC2A3
                ply

rts9EBC:
                rts

;-------------------------------------------------------------------------

L9EBD:
                clc
                lda LC30F,y
                adc LC311,y
                sta L00C3
                lda LC30D,y
                and #3
                adc LC312,y
                sta L00C2
                rts

;-------------------------------------------------------------------------

cmd_dfs:
                tya
                ldx #$FF
                ldy #$10

L9ED6:
                pha
                jsr vstrng
                .byte $D
                .text "DFS 2.45"
                .byte $D

                stx L00BE+1
                sty L00B7

L9EE8:
                lda #0
                sta L00B9
                ldy #2
                jsr L9F91
                jsr L9F33
                jsr LA7DD
                dec L00B7
                bne L9EE8
                pla
                tay

L9EFD:
                ldx #$8E
                jmp L86BA

;-------------------------------------------------------------------------

                tya
                ldx #$80
                ldy #1
                bne L9ED6
L9F09:
                jsr L8703
                beq rts9F8B

L9F0E:
                jsr L8149
                bcc L9F0E
                bcs L9EFD

L9F15:
                jsr L8703
                bne rts9F8B

L9F1A:
                jsr do_following_brk

;-------------------------------------------------------------------------

aSyntax:
                .byte $dc
                .text "Syntax: "

;-------------------------------------------------------------------------

                stx L00B9
                jsr L9F33
                lda #0
                jsr L9F7F
                jmp L0100

;-------------------------------------------------------------------------

L9F33:
                ldx L00BE+1
                lda #9
                sta L00B8

L9F39:
                inx
                lda comtab,x    ; "ACCESS"
                bmi L9F45
                jsr L9F7F
                jmp L9F39

;-------------------------------------------------------------------------

L9F45:
                ldy L00B8
                cpy #$C
                beq L9F4E
                jsr L9F91

L9F4E:
                inx
                inx
                stx L00BE+1
                lda comtab,x    ; "ACCESS"
                jsr L9F5B
                jsr L81BE

;-------------------------------------------------------------------------

L9F5B:
                jsr savita
                and #$F
                beq rts9F8B
                tay
                lda #$20
                jsr L9F7F
                ldx #$FF

L9F6A:
                inx
                lda L9F9E,x
                bpl L9F6A
                dey
                bne L9F6A
                and #$7F

L9F75:
                jsr L9F7F
                inx
                lda L9F9E,x
                bpl L9F75
                rts

;-------------------------------------------------------------------------

L9F7F:
                jsr savita
                ldx L00B9
                beq L9F8C
                inc L00B9
                sta $100,x

rts9F8B:
                rts

;-------------------------------------------------------------------------

L9F8C:
                dec L00B8
                jmp pchr

;-------------------------------------------------------------------------

L9F91:
                lda L00B9
                bne rts9F9D
                lda #$20

L9F97:
                jsr L9F7F
                dey
                bne L9F97

rts9F9D:
                rts

;-------------------------------------------------------------------------

L9F9E:      .byte $BC
                .text "fsp>"
                .byte $BC
                .text "afsp>"
                .byte $A8
                .text "L)"
                .byte $BC
                .text "source> <dest.>"
                .byte $BC
                .text "old fsp> <new fsp>"
                .byte $A8
                .text "<dir>)"
                .byte $A8
                .text "<drive>)"
                .byte $BC
                .text "title>"
                .byte $BC
                .text "drive> (40)(80)"
                .byte $B4
                .text "0/80"
                .byte $A8
                .text "<drive>)..."
                .byte $A8
                .text "<rom>)"
                .byte $FF
                .text "L.!BOOT"
                .byte $D
                .text "E.!BOOT"
                .byte $D

;-------------------------------------------------------------------------

LA01F:
                bit L0DF0,x
                bpl LA027
                bvs LA029
                rts

;-------------------------------------------------------------------------

LA027:
                bvs rtsA04F

LA029:
                cmp #$12
                beq LA074
                cmp #$B

LA02F:
                bcc LA03B
                cmp #$28
                bcs rtsA04F
                cmp #$21
                bcc rtsA04F
                sbc #$16

LA03B:
                asl a
                tax
                lda LA050+1,x
                pha
                lda LA050,x
                pha
                txa
                ldx L00F4
                lsr a
                cmp #$B
                bcc rtsA04F
                adc #$15

rtsA04F:
                rts

;-------------------------------------------------------------------------

LA050:
                .word rts861B-1
                .word rts861B-1
                .word LA1A0-1
                .word LA07C-1
                .word LA1D9-1
                .word rts861B-1
                .word rts861B-1
                .word rts861B-1
                .word LA210-1
                .word LA1E1-1
                .word LA1F4-1
                .word LA278-1
                .word LA27F-1
                .word rts861B-1
                .word LA287-1
                .word LA28A-1
                .word LA2B0-1
                .word LA268-1

;-------------------------------------------------------------------------

LA074:
                jsr savita
                cpy #4
                beq LA0B0
                rts

;-------------------------------------------------------------------------

LA07C:
                jsr savita
                sty L00B3
                lda #$7A
                jsr OSBYTE
                txa
                bmi LA099
                cmp #$32
                beq LA094
                cmp #$61
                bne rtsA04F
                jsr LADDB

LA094:
                lda #$78
                jsr OSBYTE

LA099:
                lda L00B3
                jsr vstrng
                .text "Acorn 1770 DFS"
                .byte $D
                .byte $D

                bra LA0B2

;-------------------------------------------------------------------------

LA0B0:
                lda #$FF

LA0B2:
                jsr L97D4

;-------------------------------------------------------------------------

LA0B5:
                pha
                lda #6
                jsr L8020
                ldx #$D

LA0BD:
                lda vtabb,x
                sta FILEV,x
                dex
                bpl LA0BD
                lda #$A8
                jsr readby
                stx L00B0
                sty L00B1
                ldx #7
                ldy #$1B

LA0D3:
                lda LA5D3,y
                sta (L00B0),y
                iny
                lda LA5D3,y
                sta (L00B0),y
                iny
                lda L00F4
                sta (L00B0),y
                iny
                dex
                bne LA0D3
                sty LC282
                sty LC283
                stx L00CD
                lda #$FF
                sta LC287
                ldy #3

LA0F6:
                sta LC28B,y
                dey
                bpl LA0F6
                ldx #$F
                jsr LA5D3
                jsr LA5AE
                ldy #$D3
                lda (L00B0),y
                bpl LA13D
                pla
                pha
                beq LA13D
                ldy #$D4

LA110:
                lda (L00B0),y
                bmi LA16B
                jsr LA59E
                ldy #0

LA119:
                lda (L00B0),y
                cpy #$C0
                bcc LA124
                sta LC200,y
                bcs LA127

LA124:
                sta LC300,y

LA127:
                dey
                bne LA119
                lda #$A0

LA12C:
                tay
                pha
                lda #$3F
                jsr L99B9
                pla
                sta seqdah,y
                sbc #$1F
                bne LA12C
                beq LA16B

LA13D:
                jsr LA59E
                lda #$24
                sta LC2C9
                sta LC2CB
                ldy #0
                sty LC2CA
                sty LC2CC
                ldy #0
                sty LC2C0
                ldx #3
                tya

LA158:
                sta LC2DE,x
                dex
                bne LA158
                dey
                sty LC2C7
                sty LC2C6
                sty LC2DD
                sty LC2A6

LA16B:
                jsr L8F57
                pla
                bne rtsA18C
                lda #4
                ora LC2DE
                sta LC2DE
                jsr L943A
                lda #$FB
                and LC2DE
                sta LC2DE
                lda LC106
                jsr L81BE
                bne LA18D

rtsA18C:
                rts

;-------------------------------------------------------------------------

LA18D:
                ldy #$A0
                ldx #$F
                cmp #2
                bcc LA19D
                beq LA19B
                ldx #$17
                bne LA19D

LA19B:
                ldx #$19

LA19D:
                jmp OSCLI

;-------------------------------------------------------------------------

LA1A0:
                lda L0DF0,x
                cmp #$dc
                bcc LA1AB
                tya
                sta L0DF0,x

LA1AB:
                phy
                sta L00B1
                stz L00B0
                lda #$FD
                jsr readby
                dex
                txa
                ldy #$D3
                and (L00B0),y
                sta (L00B0),y
                php
                iny
                plp
                bpl LA1C9
                lda (L00B0),y
                bpl LA1C9
                jsr L892A

LA1C9:
                lda #0
                sta (L00B0),y
                lda #2
                ldx L00F4
                ply
                bit L0DF0,x
                bmi rtsA1D8
                iny

rtsA1D8:
                rts

;-------------------------------------------------------------------------

LA1D9:
                jsr savita
                ldx #$7E

LA1DE:
                jmp L86BA

;-------------------------------------------------------------------------

LA1E1:
                jsr savita
                lda (L00F2),y
                ldx #$8E
                cmp #$D
                bne LA1DE
                tya
                inx
                inx
                ldy #1
                jmp L9ED6

;-------------------------------------------------------------------------

LA1F4:
                jsr LA5AE
                ldy #0
                jsr L97BB
                jsr L892A
                jsr LA5AE
                ldy #$D4
                lda #0
                sta (L00B0),y
                rts

;-------------------------------------------------------------------------

                lda #$A

LA20B:
                tsx
                sta $105,x
                rts

;-------------------------------------------------------------------------

LA210:
                jsr savita
                jsr L97D4
                ldy L00EF
                bmi LA20B
                cpy #$7D
                bcc LA20B
                tax
                jsr LA5AE
                ldy #$D4
                lda (L00B0),y
                pha
                phx
                pla
                plx
                bpl LA20B
                ldx L00F0
                stx L00C7
                ldx L00F1
                stx L00C8
                iny
                bpl LA23E
                ldx L00C7
                ldy L00C8
                jmp L91F4

;-------------------------------------------------------------------------

LA23E:
                jsr L8B52
                jsr L8388
                iny
                bmi LA24F
                ldy #0
                lda LC104
                sta (L00C7),y
                rts

;-------------------------------------------------------------------------

LA24F:
                lda #0
                tay
                sta (L00C7),y
                iny
                lda LC107
                sta (L00C7),y
                iny
                lda LC106
                and #3
                sta (L00C7),y
                iny
                lda #0
                sta (L00C7),y
                rts

;-------------------------------------------------------------------------

LA268:
                jsr savita
                jsr LA5AE
                ldy #$D4
                lda (L00B0),y
                bpl rtsA277
                sta LC282

rtsA277:
                rts

;-------------------------------------------------------------------------

LA278:
                cpy #$CA
                bcs rtsA27E
                ldy #$CA

rtsA27E:
                rts

;-------------------------------------------------------------------------

LA27F:
                tya
                sta L0DF0,x
                lda #$22
                iny
                rts

;-------------------------------------------------------------------------

LA287:
                dey
                dey
                rts

;-------------------------------------------------------------------------

LA28A:
                ldx #$15

LA28C:
                lda LA29A,x
                sta ($F2),y
                iny
                dex
                bpl LA28C
                lda #$25
                ldx L00F4
                rts

;-------------------------------------------------------------------------

LA29A:      .byte 4
                .byte $15
                .byte $11
aCsid:          .text "    CSID"
                .byte 4
                .byte $15
                .byte $11
aKsid:          .text "    KSID"

;-------------------------------------------------------------------------

LA2B0:
                phy
                jsr LA5AE
                ldx LC2C0
                ldy #$D4
                lda (L00B0),y
                bmi LA2CA
                ldy #$C0
                lda (L00B0),y
                and #$F8
                beq LA2CF
                lda #$FF
                jsr LA0B5

LA2CA:
                ldy #0
                jsr L95B4

LA2CF:
                ply
                ldx L00F4
                lda #$26
                rts

;-------------------------------------------------------------------------

LA2D5:
                jsr savit
                pha
                jsr LA49E
                stx L00B0
                stx LC2DB
                sty L00B1
                sty LC2DC
                ldx #0
                ldy #0
                jsr L80E3

LA2ED:
                jsr L80D3
                cpy #$12
                bne LA2ED
                pla
                tax
                inx
                cpx #9
                bcs LA303
                lda LA624,x
                pha
                lda LA61B,x
                pha

LA303:
                lda #0
                rts

;-------------------------------------------------------------------------

LA306:
                cmp #$C
                bcs LA303
                stx L00B5
                tax
                lda LA60F,x ; >table -1
                pha
                lda LA603,x
                pha
                txa
                ldx L00B5

rtsA318:
                rts

;-------------------------------------------------------------------------

LA319:
                cmp #9
                bcs rtsA318
                jsr savita
                jsr L97D4
                stx LC27D
                sty LC27E
                tay
                jsr LA333
                php
                jsr L9E8C
                plp
                rts

;-------------------------------------------------------------------------

LA333:

                lda LA62D,y  ; < table
                sta LC2D7
                lda LA636,y  ; > table
                sta LC2D7+1
                lda wbrwtb,y
                lsr a
                php
                lsr a
                php
                sta LC27F
                jsr LA464
                ldy #$C

LA34E:
                lda (L00B4),y
                sta LC260,y
                dey
                bpl LA34E
                jsr L9E30
                plp
                bcs LA360
                plp

;-------------------------------------------------------------------------

LA35D:
                jmp (LC2D7)

;-------------------------------------------------------------------------

LA360:
                jmp L9C8B

;-------------------------------------------------------------------------

LA363:
                jsr LA456
                bmi LA375

LA368:
                ldy LC260
                jsr LA35D
                bcs LA37D
                ldx #9
                jsr LA44A

LA375:
                ldx #5
                jsr LA44A
                bne LA368
                clc

LA37D:
                php
                jsr LA456
                ldx #5
                jsr LA44A
                ldy #$C
                jsr LA464

LA38B:
                lda LC260,y
                sta (L00B4),y
                dey
                bpl LA38B
                plp
                rts

;-------------------------------------------------------------------------

LA395:
                jsr L8B52
                jsr L9442
                lda #<LA3A7
                sta LC2D7
                lda #>LA3A7
                sta LC2D7+1
                bne LA363

LA3A7:
                ldy LC269

LA3AA:
                cpy LC105
                bcs LA3D7
                lda LC00F,y
                jsr L832F
                eor L00CC
                bcs LA3BB
                and #$DF

LA3BB:
                and #$7F
                beq LA3C4
                jsr iny8
                bne LA3AA

LA3C4:
                lda #7
                jsr LA471
                sta L00B0

LA3CB:
                lda LC008,y
                jsr LA471
                iny
                dec L00B0
                bne LA3CB
                clc

LA3D7:
                sty LC269
                lda LC104
                sta LC260
                rts

;-------------------------------------------------------------------------

LA3E1:
                jsr L8B52
                jsr L9442
                lda #$C
                jsr LA471
                ldy #0

LA3EE:
                cpy #8
                bcs LA3F7
                lda LC000,y
                bcc LA3FA

LA3F7:
                lda LC0F8,y

LA3FA:
                jsr LA471
                iny
                cpy #$C
                bne LA3EE
                lda LC106
                jsr L81BE
                jsr LA471
                lda L00CD
                jmp LA471

;-------------------------------------------------------------------------

LA410:
                jsr LA46F
                lda LC2CA
                ora #$30
                jsr LA471
                jsr LA46F
                lda LC2C9
                bne LA471
LA423:
                jsr LA46F
                lda LC2CC
                ora #$30
                jsr LA471
                jsr LA46F
                lda LC2CB
                bne LA471

;-------------------------------------------------------------------------

LA436:
                pha
                lda LC261
                sta L00B8
                lda LC262
                sta L00B9
                ldx #0
                pla
                rts

;-------------------------------------------------------------------------

LA445:
                jsr savita
                ldx #1

;-------------------------------------------------------------------------

LA44A:
                ldy #4

LA44C:
                inc LC260,x
                bne rtsA455
                inx
                dey
                bne LA44C

rtsA455:
                rts

;-------------------------------------------------------------------------

LA456:
                ldx #3

LA458:
                lda #$FF
                eor LC265,x
                sta LC265,x
                dex
                bpl LA458
                rts

;-------------------------------------------------------------------------

LA464:
                lda LC27D
                sta L00B4
                lda LC27E
                sta L00B5
                rts

;-------------------------------------------------------------------------

LA46F:
                lda #1

;-------------------------------------------------------------------------

LA471:

                bit LC281
                bpl LA47B
                sta LFEE5
                bmi LA445

LA47B:
                jsr LA436
                sta (L00B8,x)
                jmp LA445

;-------------------------------------------------------------------------

                bit LC281
                bpl LA48E
                lda LFEE5
                jmp LA445

;-------------------------------------------------------------------------

LA48E:
                jsr LA436
                lda (L00B8,x)
                jmp LA445

;-------------------------------------------------------------------------

LA496:
                bit LC2C7
                bmi LA49E
                dec LC2C7

;-------------------------------------------------------------------------

LA49E:
                lda #$FF
                sta LC2CE

LA4A3:
                sta LC2CD
                rts

;-------------------------------------------------------------------------

LA4A7:
                lda #$2A
                sta LC2CE
                lda #$23
                bne LA4A3
LA4B0:
                jsr LA569
                jsr L838E
                lda #1
                rts

;-------------------------------------------------------------------------

LA4B9:
                jsr LA546
                jsr L838E
                jsr L8312
                bcc LA4E8
LA4C4:
                jsr LA569
                jsr LA4EE
                jsr LA50A
                bvc LA4E5
LA4CF:
                jsr LA569
                jsr LA50A
                bvc LA4E8
LA4D7:
                jsr LA569
                jsr LA4EE
                bvc LA4E8
LA4DF:
                jsr LA569
                jsr LA55E

LA4E5:
                jsr LA52D

LA4E8:
                jsr L89AE
                lda #1
                rts

;-------------------------------------------------------------------------

LA4EE:
                jsr savita
                ldy #2
                lda (L00B0),y
                sta LC108,x
                iny
                lda (L00B0),y
                sta LC109,x
                iny
                lda (L00B0),y
                asl a
                asl a
                eor LC10E,x
                and #$C
                bpl LA525

;-------------------------------------------------------------------------

LA50A:
                jsr savita
                ldy #6
                lda (L00B0),y
                sta LC10A,x
                iny
                lda (L00B0),y
                sta LC10B,x
                iny
                lda (L00B0),y
                ror a
                ror a
                ror a
                eor LC10E,x
                and #$C0

LA525:
                eor LC10E,x
                sta LC10E,x
                clv
                rts

;-------------------------------------------------------------------------

LA52D:
                jsr savita
                ldy #$E
                lda (L00B0),y
                and #$A
                beq LA53A
                lda #$80

LA53A:
                eor LC00F,x
                and #$80
                eor LC00F,x
                sta LC00F,x
                rts

;-------------------------------------------------------------------------

LA546:
                jsr LA573
                bcc LA56E

LA54B:
                lda LC00F,y
                bpl rtsA572

LA550:
                jsr estrng

;-------------------------------------------------------------------------

                .byte $C3
aLocked:        .text "Locked"
                .byte 0

;-------------------------------------------------------------------------

LA55B:

                jsr LA54B

LA55E:
                jsr savita
                jsr L9764
                bcc rtsA587
                jmp L96C8

;-------------------------------------------------------------------------

LA569:
                jsr LA573
                bcs rtsA587

LA56E:
                pla
                pla
                lda #0

rtsA572:
                rts

;-------------------------------------------------------------------------

LA573:
                jsr L80F3
                jsr lookup
                bcc rtsA587
                tya
                tax

LA57D:
                lda LC2DB
                sta L00B0
                lda LC2DC
                sta L00B1

rtsA587:
                rts

;-------------------------------------------------------------------------

LA588:
                lda #$83
                jsr OSBYTE
                sty LC2CF
                lda #$84
                jsr OSBYTE
                tya
                sec
                sbc LC2CF
                sta LC2D0
                rts

;-------------------------------------------------------------------------

LA59E:
                jsr LA5AE
                ldy #$D3
                lda #$FF
                sta (L00B0),y
                sta LC2D3
                iny
                sta (L00B0),y
                rts

;-------------------------------------------------------------------------

LA5AE:
                pha
                lda #0
                sta L00B0
                ldx L00F4
                lda L0DF0,x
                sta L00B1
                pla
                rts

;-------------------------------------------------------------------------

LA5BC:
                jsr savita
                lda #$F
                ldx #1
                ldy #0
                beq LA5DD

;-------------------------------------------------------------------------

wriwde:
                tax

LA5C8:
                lda #3
                bne LA5DD

;-------------------------------------------------------------------------

LA5CC:
                jsr savita
                lda #$7E
                bne LA5DD

;-------------------------------------------------------------------------

LA5D3:
                lda #$8F
                bne LA5DD
                lda #$FF

;-------------------------------------------------------------------------

readby:
                ldx #0
                ldy #$FF

LA5DD:
                jmp OSBYTE

;-------------------------------------------------------------------------

vtabb:          .word $FF1B
                .word $FF1E
                .word $FF21
                .word $FF24
                .word $FF27
                .word $FF2A
                .word $FF2D
vtabf:          .word LA2D5
                .byte 0
                .word L97E1
                .byte 0
                .word L9946
                .byte 0
                .word L9A1A
                .byte 0
                .word LA319
                .byte 0
                .word L9652
                .byte 0
                .word LA306
                .byte 0

routines_a603_a60f=[L8A09-1,L9910-1,L8829-1,L86B5-1,L8829-1,L8483-1,L9592-1,L958D-1,LA496-1,L8237-1,L8256-1,L8836-1]

LA603: .byte <routines_a603_a60f
LA60F: .byte >routines_a603_a60f

routines_a61b_a624=[L87D2-1,L8810-1,LA4C4-1,$A4D7-1,LA4CF-1,LA4DF-1,LA4B0-1,LA4B9-1,L8A4E-1]
                
LA61B: .byte <routines_a61b_a624
LA624: .byte >routines_a61b_a624

routines_a62d_a636=[rts861B,L99F9,L99F9,L9EA6,L9EA6,LA3E1,LA410,LA423,LA395]
                
LA62D: .byte <routines_a62d_a636
LA636: .byte >routines_a62d_a636

wbrwtb:         .byte 4
                .byte 2
                .byte 3
                .byte 6
                .byte 7
                .byte 4
                .byte 4
                .byte 4
                .byte 4

;-------------------------------------------------------------------------

cmd_compact:
                jsr L8B5D
                jsr vstrng
                .text "Compacting :"

                sta LC2D1
                sta LC2D2
                jsr L80C3
                jsr LA7DD
                ldy #0
                jsr L95BF
                jsr LA588
                jsr L8388
                ldy LC105
                sty L00CA
                lda #2
                sta L00C8
                lda #0
                sta L00C9

LA67E:
                ldy L00CA
                jsr L82BA
                cpy #$F8
                bne LA6AF
                lda LC107
                sec
                sbc L00C8
                pha
                lda LC106
                and #3
                sbc L00C9
                jsr L80C3
                pla
                jsr L80BB
                jsr vstrng
                .text " free sectors"
                .byte $D

                nop
                rts

;-------------------------------------------------------------------------

LA6AF:
                sty L00CA
                jsr L833D
                ldy L00CA
                lda LC10C,y
                cmp #1
                lda #0
                sta L00BC
                sta L00C0
                adc LC10D,y
                sta L00C4
                lda LC10E,y
                php
                jsr L81B0
                plp
                adc #0
                sta L00C5
                lda LC10F,y
                sta L00C6
                lda LC10E,y
                and #3
                sta L00C7
                cmp L00C9
                bne LA6F6
                lda L00C6
                cmp L00C8
                bne LA6F6
                clc
                adc L00C4
                sta L00C8
                lda L00C9
                adc L00C5
                sta L00C9
                jmp LA711

;-------------------------------------------------------------------------

LA6F6:
                lda L00C8
                sta LC10F,y
                lda LC10E,y
                and #$FC
                ora L00C9
                sta LC10E,y
                lda #0
                sta L00A8
                sta L00A9
                jsr LA931
                jsr L942B

LA711:
                ldy L00CA
                jsr L8342
                jmp LA67E

;-------------------------------------------------------------------------

LA719:
                bit LC2C7
                bpl rtsA779
                jsr LA7ED
                beq LA725
                pla
                pla

LA725:
                jmp LA7DD

;-------------------------------------------------------------------------

LA728:
                jsr L9F15
                jsr L8B62
                sta LC2D1
                jsr L9F15
                jsr L8B62
                sta LC2D2
                phy
                stz L00A9
                lda LC2D2
                cmp LC2D1
                bne LA74B
                lda #$FF
                sta L00A9
                sta L00AA

LA74B:
                jsr LA588
                jsr vstrng
                .text "Copying from :"

                lda LC2D1
                jsr L80C3
                jsr vstrng
                .text " to :"

                lda LC2D2
                jsr L80C3
                jsr LA7DD
                pla
                tay
                clc

rtsA779:
                rts

;-------------------------------------------------------------------------

LA77A:

                jsr savita
                bit L00A9
                bpl rtsA78C
                lda #0
                bra LA78F

;-------------------------------------------------------------------------

LA785:

                jsr savita
                bit L00A9
                bmi LA78D

rtsA78C:
                rts

;-------------------------------------------------------------------------

LA78D:
                lda #$80

LA78F:
                cmp L00AA
                beq rtsA78C
                sta L00AA
                jsr vstrng
                .text "Insert "

                nop
                bit L00AA
                bmi LA7AF
                jsr vstrng
                .text "source"

                bcc LA7BE

LA7AF:
                jsr vstrng
                .text "destination"

                nop

LA7BE:
                jsr vstrng
                .text " disc and hit a key"

                nop
                jsr LA5BC
                jsr OSRDCH
                bcs LA812

;-------------------------------------------------------------------------

LA7DD:
                pha
                lda #$D
                jsr pchr
                pla
                rts

;-------------------------------------------------------------------------

LA7E5:
                jsr vstrng
                .text " : "

                bcc LA7FC

LA7ED:
                jsr vstrng
                .text "Go (Y/N) ? "

                nop

LA7FC:
                jsr LA5BC
                jsr OSRDCH
                bcs LA812
                and #$5F
                cmp #'Y'
                php
                beq LA80D
                lda #'N'

LA80D:
                jsr pchr
                plp
                rts

;-------------------------------------------------------------------------

LA812:
                jmp L947B

;-------------------------------------------------------------------------

LA815:
                jmp L8A45

;-------------------------------------------------------------------------

cmd_backup:
                jsr LA728
                jsr LA719
                lda #0

LA820:
                sta L00C7
                sta L00C9
                sta L00C8
                sta L00C6
                sta L00A8
                jsr LA77A
                lda LC2D1
                sta L00CD
                jsr L9451
                lda LC107
                sta L00C4
                lda LC106
                and #3
                sta L00C5
                jsr LA785
                lda LC2D2
                sta L00CD
                jsr L9451
                lda LC106
                and #3
                cmp L00C5
                bcc LA815
                bne LA85E
                lda LC107
                cmp L00C4
                bcc LA815

LA85E:
                jsr LA931
                jmp L9451

;-------------------------------------------------------------------------

cmd_copy:
                jsr LA4A7
                jsr LA728
                jsr L9F15
                jsr L80ED
                jsr LA77A
                lda LC2D1
                jsr L87CD
                jsr L8224

LA87C:
                lda L00CC
                pha
                lda L00B6
                sta L00AB
                jsr L8342
                ldx #0

LA888:
                lda LC008,y
                sta L00C5,x
                sta LC250,x
                lda LC108,y
                sta L00BB,x
                sta LC247,x
                inx
                iny
                cpx #8
                bne LA888
                lda L00C1
                jsr L81B0
                sta L00C3
                lda L00BE+1
                clc
                adc #$FF
                lda L00C0
                adc #0
                sta L00C4
                lda L00C3
                adc #0
                sta L00C5
                lda LC24E
                sta L00C6
                lda LC24D
                and #3
                sta L00C7
                lda #$FF
                sta L00A8
                jsr LA931
                jsr LA77A
                lda LC2D1
                jsr L87CD
                jsr L8388
                lda L00AB
                sta L00B6
                pla
                sta L00CC
                jsr L828A
                bcs LA87C
                rts

;-------------------------------------------------------------------------

LA8E2:
                jsr LA920
                jsr LA785
                lda LC2D2
                sta L00CD
                lda L00CC
                pha
                jsr L8388
                jsr L8277
                bcc LA8FB
                jsr L8312

LA8FB:
                pla
                sta L00CC
                jsr L8B24
                jsr L8B3B
                lda L00C2
                jsr L81B0
                sta L00C4
                jsr L8A8A
                lda L00C2
                and #3
                pha
                lda L00C3
                pha
                jsr LA920
                pla
                sta L00C8
                pla
                sta L00C9
                rts

;-------------------------------------------------------------------------

LA920:
                ldx #$11

LA922:
                lda LC245,x
                ldy L00BA,x
                sta L00BA,x
                tya
                sta LC245,x
                dex
                bpl LA922
                rts

;-------------------------------------------------------------------------

LA931:
                stz L00BC
                stz L00C0
                bra LA9AA

;-------------------------------------------------------------------------

LA937:
                lda L00C4
                tay
                cmp LC2D0
                lda L00C5
                sbc #0
                bcc LA946
                ldy LC2D0

LA946:
                sty L00C1
                lda L00C6
                sta L00C3
                lda L00C7
                sta L00C2
                lda LC2CF
                sta L00BD
                lda LC2D1
                sta L00CD
                jsr LA77A
                jsr LA9B1
                jsr L880C
                lda LC2D2
                sta L00CD
                bit L00A8
                bpl LA973
                jsr LA8E2
                lda #0
                sta L00A8

LA973:
                lda L00C8
                sta L00C3
                lda L00C9
                sta L00C2
                lda LC2CF
                sta L00BD
                jsr LA785
                jsr LA9B1
                jsr L8819
                lda L00C1
                clc
                adc L00C8
                sta L00C8
                bcc LA994
                inc L00C9

LA994:
                lda L00C1
                clc
                adc L00C6
                sta L00C6
                bcc LA99F
                inc L00C7

LA99F:
                sec
                lda L00C4
                sbc L00C1
                sta L00C4
                bcs LA9AA
                dec L00C5

LA9AA:
                lda L00C4
                ora L00C5
                bne LA937
                rts

;-------------------------------------------------------------------------

LA9B1:
                lda #$FF
                sta LC274
                sta LC275
                rts

;-------------------------------------------------------------------------

cmd_verify:
                lda #0
                beq LA9C3
cmd_form:
                lda #$FF
                sta LC282

LA9C3:
                sta L00C9
                sta LC290
                bpl LA9E4
                jsr L9F15
                jsr L8458
                sta LC29F
                bcs LA9E1
                cmp #35
                beq LA9E4
                cmp #40
                beq LA9E4
                cmp #80
                beq LA9E4

LA9E1:
                jmp L9F1A

;-------------------------------------------------------------------------

LA9E4:
                jsr L8703
                sty L00CA
                bne LAA36
                bit L00C9
                bmi LA9FA
                jsr vstrng
                .text "Verify"

                bcc LAA04

LA9FA:
                jsr vstrng
                .text "Format"

                nop

LAA04:
                jsr vstrng
                .text " which drive ? "

                nop
                jsr OSRDCH
                bcs LAA5C
                cmp #$20
                bcc LAA5F
                jsr pchr
                sec
                sbc #'0'
                bcc LAA5F
                cmp #4
                bcs LAA5F
                sta L00CD
                jsr LA7DD
                ldy L00CA
                jmp LAA39

;-------------------------------------------------------------------------

LAA36:
                jsr L8B62

LAA39:
                sty L00CA
                bit L00C9
                bpl LAA46
                ldx L00CD
                lda #0
                sta LC2DE,x

LAA46:
                bit LC290
                bpl LAA51
                jsr LA719
                jsr LA588

LAA51:
                jsr LAA62
                ldy L00CA
                jsr L8703
                bne LAA36
                rts

;-------------------------------------------------------------------------

LAA5C:
                jmp L947B

;-------------------------------------------------------------------------

LAA5F:
                jmp L8B79

;-------------------------------------------------------------------------

LAA62:
                bit L00C9
                bmi LAA74
                jsr vstrng
                .text "Verifying"

                bcc LAA89

LAA74:
                jsr LAB6B
                jsr vstrng
                .text "Formatting"

                ldx L00CD
                stx LC290

LAA89:
                jsr vstrng
                .text " drive "

                lda L00CD
                jsr L80C3
                jsr vstrng
                .text " track   "

                nop
                bit L00C9
                bmi LAAB5
                jsr LABCD
                txa
                bne LAAB2
                jmp LA7DD

;-------------------------------------------------------------------------

LAAB2:
                sta LC29F

LAAB5:
                lda #0
                sta LC297

LAABA:
                lda #8
                jsr pchr
                jsr pchr
                lda LC297
                jsr L80BB
                lda #6
                sta LC29D

LAACD:
                jsr LAB3C
                bit L00C9
                bpl LAAE1
                jsr LAB87
                ldx #<LC290
                ldy #>LC290
                jsr L91F4
                tax
                bne LAB09

LAAE1:
                lda #0
                sta LC298
                lda LC299
                and #$1F
                sta LC299
                lda #3
                sta LC295
                lda #$5F
                sta LC296
                jsr L9477
                ldx #<LC290
                ldy #>LC290
                jsr L91F4
                beq LAB11
                dec LC29D
                bne LAACD

LAB09:
                jsr vstrng
                .text "?"

                nop
                jmp L9509

;-------------------------------------------------------------------------

LAB11:
                lda LC29D
                cmp #6
                beq LAB20
                jsr vstrng
                .text "?   "

                nop

LAB20:
                bit L00C9
                bpl LAB27
                jsr LAB78

LAB27:
                inc LC297
                lda LC297
                cmp LC29F
                bne LAABA
                bit L00C9
                bpl LAB39
                jsr L9436

LAB39:
                jmp LA7DD

;-------------------------------------------------------------------------

LAB3C:
                ldx #0
                stx LC291
                stx LC29A
                dex
                stx LC293
                stx LC294
                lda LC2CF
                sta LC292
                lda #5
                sta LC295
                lda #$63
                sta LC296
                lda #$2A
                sta LC299
                ldx #$10
                ldy #$13
                stx LC29B
                sty LC298
                rts

;-------------------------------------------------------------------------

LAB6B:
                lda #0
                tay

LAB6E:
                sta LC000,y
                sta LC100,y
                iny
                bne LAB6E
                rts

;-------------------------------------------------------------------------

LAB78:
                lda #$A
                clc
                adc LC107
                sta LC107
                bcc rtsAB86
                inc LC106

rtsAB86:
                rts

;-------------------------------------------------------------------------

LAB87:
                lda #0
                sta L00B0
                lda LC2CF
                sta L00B1
                lda #$A
                sta L00B2
                lda LC297
                beq LABA3
                ldy #2
                lda (L00B0),y
                clc
                adc #7
                jsr LABC4

LABA3:
                tax
                ldy #0

LABA6:
                lda LC297
                sta (L00B0),y
                iny
                lda #0
                sta (L00B0),y
                iny
                txa
                sta (L00B0),y
                iny
                lda #1
                sta (L00B0),y
                iny
                inx
                jsr LABC3
                dec L00B2
                bne LABA6
                rts

;-------------------------------------------------------------------------

LABC3:
                txa

;-------------------------------------------------------------------------

LABC4:
                sec

LABC5:
                sbc #$A
                bcs LABC5
                adc #$A
                tax
                rts

;-------------------------------------------------------------------------

LABCD:
                jsr L943A
                lda LC106
                and #3
                tax
                lda LC107
                ldy #$A
                sty L00B0
                ldy #$FF

LABDF:
                sec

LABE0:
                iny
                sbc L00B0
                bcs LABE0
                dex
                bpl LABDF
                adc L00B0
                pha
                tya
                tax
                pla
                beq rtsABF1
                inx

rtsABF1:
                rts

;-------------------------------------------------------------------------

cmd_free:
                sec
                bcs LABF6
cmd_map:
                clc

LABF6:
                ror L00C6
                jsr L8B5D
                jsr L8388
                bit L00C6
                bmi LAC17
                jsr LAD9B
                .text "Address :  Length"
                .byte $D

LAC17:
                lda LC106
                and #3
                sta L00C5
                sta L00C2
                lda LC107
                sta L00C4
                sec
                sbc #2
                sta L00C1
                bcs LAC2E
                dec L00C2

LAC2E:
                lda #2
                sta L00BB
                lda #0
                sta L00BC
                sta L00BE+1
                sta L00C0
                lda LC105
                and #$F8
                tay
                beq LAC6A
                bne LAC55

LAC44:
                jsr LACE1
                jsr L82BA
                lda L00C4
                sec
                sbc L00BB
                lda L00C5
                sbc L00BC
                bcc LAC6A

LAC55:
                lda LC107,y
                sec
                sbc L00BB
                sta L00C1
                php
                lda LC106,y
                and #3
                plp
                sbc L00BC
                sta L00C2
                bcc LAC44

LAC6A:
                sty L00BD
                bit L00C6
                bmi LAC79
                lda L00C1
                ora L00C2
                beq LAC79
                jsr LACBD

LAC79:
                lda L00C1
                clc
                adc L00BE+1
                sta L00BE+1
                lda L00C2
                adc L00C0
                sta L00C0
                ldy L00BD
                bne LAC44
                bit L00C6
                bpl rtsACBC
                tay
                ldx L00BE+1
                lda #$F8
                sec
                sbc LC105
                jsr LAD0C
                jsr LAD9B
                .text "Free",13

                lda L00C4
                sec
                sbc L00BE+1
                tax
                lda L00C5
                sbc L00C0
                tay
                lda LC105
                jsr LAD0C
                jsr LAD9B
                .text "Used"
                .byte $D

                nop

rtsACBC:
                rts

;-------------------------------------------------------------------------

LACBD:
                lda L00BC
                jsr LADC9
                lda L00BB
                jsr LADC1
                jsr LAD9B
                .text "     :  "

                lda L00C2
                jsr LADC9
                lda L00C1
                jsr LADC1
                lda #$D
                jsr OSASCI

;-------------------------------------------------------------------------

LACE1:
                lda LC106,y
                pha
                jsr L81B0
                sta L00BC
                pla
                and #3
                clc
                adc L00BC
                sta L00BC
                lda LC104,y
                beq LACF9
                lda #1

LACF9:
                clc
                adc LC105,y
                bcc LAD01
                inc L00BC

LAD01:
                clc
                adc LC107,y
                sta L00BB
                bcc rtsAD0B
                inc L00BC

rtsAD0B:
                rts

;-------------------------------------------------------------------------

LAD0C:
                jsr L81BF
                jsr LADBE
                jsr LAD9B
                .text " Files "

                stx L00BC
                sty L00BD
                tya
                jsr LADC9
                txa
                jsr LADC1

LAD28:
                jsr LAD9B
                .text " Sectors "

                lda #0
                sta L00BB
                sta L00BE
                ldx #$1F
                stx L00C1
                ldx #9

LAD40:
                sta LC200,x
                dex
                bpl LAD40

LAD46:
                asl L00BB
                rol L00BC
                rol L00BD
                rol L00BE
                ldx #0
                ldy #9

LAD52:
                lda LC200,x
                rol a
                cmp #$A
                bcc LAD5C
                sbc #$A

LAD5C:
                sta LC200,x
                inx
                dey
                bpl LAD52
                dec L00C1
                bpl LAD46
                ldy #$20
                ldx #5

LAD6B:
                bne LAD6F
                ldy #$2C

LAD6F:
                lda LC200,x
                bne LAD7C
                cpy #$2C
                beq LAD7C
                lda #$20
                bne LAD81

LAD7C:
                ldy #$2C
                clc
                adc #'0'

LAD81:
                jsr OSASCI
                cpx #3
                bne LAD8C
                tya
                jsr OSASCI

LAD8C:
                dex
                bpl LAD6B
                jsr LAD9B
                .text " Bytes "

                nop
                rts

;-------------------------------------------------------------------------

LAD9B:
                sta L00B3
                pla
                sta L00AE
                pla
                sta L00AE+1
                lda L00B3
                pha
                tya
                pha
                ldy #0

LADAA:
                jsr L83E4
                lda (L00AE),y
                bmi LADB7
                jsr OSASCI
                jmp LADAA

;-------------------------------------------------------------------------

LADB7:
                pla
                tay
                pla
                clc
                jmp (L00AE)

;-------------------------------------------------------------------------

LADBE:
                jsr L841D

;-------------------------------------------------------------------------

LADC1:
                pha
                jsr L81BE
                jsr LADC9
                pla

;-------------------------------------------------------------------------

LADC9:
                jsr L80C8
                jmp OSASCI

;-------------------------------------------------------------------------

LADCF:
                jsr LADD2

;-------------------------------------------------------------------------

LADD2:
                pha
                lda #' '
                jsr OSASCI
                pla
                clc
                rts

;-------------------------------------------------------------------------

LADDB:
                jsr savita
                lda #$40
                sta LC2DE
                lda #$A8
                jsr readby
                stx L00B0
                sty L00B1
                ldy #$F
                lda #$4C
                sta LC2E2
                lda BYTEV
                sta LC2E3
                lda BYTEV+1
                sta LC2E4
                php
                sei
                lda #$F
                sta BYTEV
                lda #$FF
                sta BYTEV+1
                lda #$1B
                sta (L00B0),y
                iny
                lda #$AE
                sta (L00B0),y
                iny
                lda L00F4
                sta (L00B0),y
                plp
                rts

;-------------------------------------------------------------------------

                cmp #0
                beq LAE30
                cmp #$81
                bne LAE2D
                cpy #$FF
                bne LAE2D
                cpx #0
                bne LAE2D
                dex
                rts

;-------------------------------------------------------------------------

LAE2D:
                jmp LC2E2

;-------------------------------------------------------------------------

LAE30:
                php
                sei
                lda LC2E3
                sta BYTEV
                lda LC2E4
                sta BYTEV+1
                lda #0
                ldx #1
                plp
                rts

;-------------------------------------------------------------------------

                .fill $af00-*,$ff

                .if !truncated

                ; https://github.com/tom-seddon/acorn_mos_disassembly/blob/14b11a60f9804c57d6edfce347d645de3fd1f66f/dist/mos350.lst#L2942
                
                .byte $E0,$C0,$A0, $80, $4C, $11,$B0,$A2, 0,$AD; 0
                .byte $38, 8,$D0, 4,$E8,$CE, $38, 8, $8E, $3B  ; 10
                .byte 8,$A2, 8,$CA,$BD, 0, 8,$F0,$E7,$BD       ; 20
                .byte $CE, 2, $30, 5,$BD, $18, 8,$D0, 8, $20   ; 30
                .byte $19,$B0,$BD, $18, 8,$F0, $12, $1A,$F0, $12; 40
                .byte $DE, $1C, 8,$D0, $D,$A9, 5, $9D, $1C, 8   ; 50
                .byte $DE, $18, 8,$D0, 3, $20, $19,$B0,$BD, $24 ; 60
                .byte 8,$F0, 5,$DE, $24, 8,$D0,$B6,$BC, $20     ; 70
                .byte 8,$C0,$FF,$F0,$AF,$B9,$C0, 8, $29, $7F    ; 80
                .byte $9D, $24, 8,$BD, 8, 8,$C9, 4,$F0, $5D     ; 90
                .byte $18, $7D, $20, 8,$A8,$B9,$CB, 8, $38,$E9  ; 100
                .byte $3F, $8D, $3A, 8,$B9,$C7, 8, $8D, $39, 8  ; 110
                .byte $BD, 4, 8, $48, $18, $6D, $39, 8, $50, 7  ; 120
                .byte $2A,$A9, $3F,$B0, 2, $49,$FF, $9D, 4, 8   ; 130
                .byte $2A, $5D, 4, 8, $10, 9,$A9, $3F, $90, 2   ; 140
                .byte $49,$FF, $9D, 4, 8,$CE, $39, 8,$BD, 4     ; 150
                .byte 8, $38,$ED, $3A, 8, $4D, $39, 8, $30, 9   ; 160
                .byte $AD, $3A, 8, $9D, 4, 8,$FE, 8, 8, $68     ; 170
                .byte $5D, 4, 8, $29,$F8,$F0, 6,$BD, 4, 8       ; 180
                .byte $20, $8A,$B0,$BD, $10, 8,$C9, 3,$F0, $49  ; 190
                .byte $BD, $14, 8,$D0, $28,$FE, $10, 8,$BD, $10 ; 200
                .byte 8,$C9, 3,$D0, $E,$BC, $20, 8,$B9,$C0      ; 210
                .byte 8, $30, $32, $9E, $30, 8, $9E, $10, 8,$BD ; 220
                .byte $10, 8, $18, $7D, $20, 8,$A8,$B9,$C4, 8   ; 230
                .byte $9D, $14, 8,$F0, $1C,$DE, $14, 8,$BD, $20 ; 240
                .byte 8, $18, $7D, $10, 8,$A8,$B9,$C1, 8, $18   ; 250
                .byte $7D, $30, 8, $9D, $30, 8, $18, $7D, $C, 8 ; 260
                .byte $20,$C6,$B0,$E0, 4,$F0, 3, $4C, $17,$AF   ; 270
                .byte $60,$BD, 8, 8,$C9, 4,$F0, 5,$A9, 3        ; 280
                .byte $9D, 8, 8,$BD,$CE, 2,$F0, $14,$A9, 0      ; 290
                .byte $9E,$CE, 2,$A0, 4, $99, $2B, 8, $88,$D0   ; 300
                .byte $FA, $9E, $18, 8, $88, $8C, $38, 8,$BD, $28; 310
                .byte 8,$F0, $60,$AD, $3B, 8,$F0, $34, $9E, $28  ; 320
                .byte 8, $4C, $75,$B1, $20, $83,$B0, $98, $9E, $18; 330
                .byte 8, $9E,$CE, 2, $9E, 0, 8,$A0, 3, $99        ; 340
                .byte $2C, 8, $88, $10,$FA, $8C, $38, 8, $80, $63 ; 350
                .byte 8, $78,$BD, 8, 8,$C9, 4,$D0, $A, $20        ; 360
                .byte $B3,$E9, $90, 5,$A9, 0, $9E, 0, 8, $28      ; 370
                .byte $BC, $20, 8,$C0,$FF,$D0, $72,$A9, 4, $9D    ; 380
                .byte 8, 8,$A9,$C0, $9D, 4, 8,$AC, $62, 2         ; 390
                .byte $F0, 2,$A9,$C0, $38,$E9, $40, $4A, $4A, $4A ; 400
                .byte $49, $F, $1D,$FC,$AE, 9, $10, $80, $34, $20 ; 410
                .byte $B3,$E9,$B0,$C0, $29, 3,$F0, $9F,$AD, $38   ; 420
                .byte 8,$F0,$CB,$FE, $28, 8,$A8, $10, $A, $20     ; 430
                .byte $B3,$E9, $29, 3, $8D, $38, 8, $80,$BB,$CE   ; 440
                .byte $38, 8, $80,$B6,$DD, $2C, 8,$F0, $2A, $9D   ; 450
                .byte $2C, 8,$E0, 4,$D0, $24, $29, $F, $1D,$FC    ; 460
                .byte $AE, 8, $78,$A0,$FF, $8C, $43,$FE, $8D, $4F ; 470
                .byte $FE,$C8, $8C, $40,$FE,$A0, 2, $88,$D0,$FD   ; 480
                .byte $A0, 8, $8C, $40,$FE,$A0, 4, $88,$D0,$FD    ; 490
                .byte $28, $60, $48, $29, 3, $8D, $3C, 8, $9C, $3D; 500
                .byte 8, $68, $4A, $4A,$C9, $C, $90, 7,$EE, $3D   ; 510
                .byte 8,$E9, $C,$D0,$F5,$A8,$AD, $3D, 8, $48      ; 520
                .byte $B9,$D4,$B1, $8D, $3D, 8,$B9,$E0,$B1, $48   ; 530
                .byte $29, 3, $8D, $3E, 8, $68, $20, $20,$E5, $8D ; 540
                .byte $3F, 8,$AD, $3D, 8,$AC, $3C, 8,$F0, $C      ; 550
                .byte $38,$ED, $3F, 8,$B0, 3,$CE, $3E, 8, $88     ; 560
                .byte $D0,$F4, $8D, $3D, 8, $68,$A8,$F0, 9, $4E   ; 570
                .byte $3E, 8, $6E, $3D, 8, $88,$D0,$F7,$AD, $3D   ; 580
                .byte 8, $18, $7D, $63,$E1, $8D, $3D, 8, $90, 3   ; 590
                .byte $EE, $3E, 8, $29, $F, $1D,$FC,$AE, 8, $78   ; 600
                .byte $20,$D7,$B0,$AD, $3D, 8, $4E, $3E, 8, $6A   ; 610
                .byte $4E, $3E, 8, $6A, $4A, $4A, $4C,$D8,$B0, 8  ; 620
                .byte $78, $20,$B8,$E9, $48, $29, 4,$F0, $13, $68 ; 630
                .byte $BC, $20, 8,$C8,$D0, 3, $20, $83,$B0, $20   ; 640
                .byte $B8,$E9, $20,$B8,$E9, $28, $80, $3E, $68, $29; 650
                .byte $F8, $A, $90, $B, $49,$FF, $4A, $38,$E9, $40 ; 660
                .byte $20, $8A,$B0,$A9,$FF, $9D, $20, 8,$A9, 5     ; 670
                .byte $9D, $1C, 8,$A9, 1, $9D, $24, 8, $9E, $14    ; 680
                .byte 8, $9E, 8, 8, $9E, $30, 8,$A9,$FF, $9D       ; 690
                .byte $10, 8, $20,$B8,$E9, $9D, $C, 8, $20,$B8     ; 700
                .byte $E9, $28, $48,$BD, $C, 8, $20,$C6,$B0, $68   ; 710
                .byte $9D, $18, 8, $60,$F0,$B7, $82, $4F, $20,$F3  ; 720
                .byte $C8,$A0, $7B, $57, $35, $16,$E7,$D7,$CB,$C3  ; 730
                .byte $B7,$AA,$A2, $9A, $92, $8A, $82, $7A,$FF,$FF ; 740
                .byte $FF,$FF,$FF,$FF,$FF, $20, $3A,$B3, $80, 3    ; 750
                .byte $20,$F4,$B3,$A2, $34,$A0, $3C, $20,$CB,$D5   ; 760
                .byte $AD, $39, 3, $8D, $43, 3,$AE, $38, 3, $8E    ; 770
                .byte $42, 3, $20, $2B,$B5,$E8,$D0, 3,$EE, $43     ; 780
                .byte 3, $8A,$D9, 0, 3,$AD, $43, 3,$F9, 1          ; 790
                .byte 3, $30,$E8,$AC, $43, 3, $8A,$D0, 1, $88      ; 800
                .byte $CA, $8E, $34, 3, $8C, $35, 3, $8A,$CD, $3A  ; 810
                .byte 3, $98,$ED, $3B, 3, $10, $30,$A2, $36,$A0    ; 820
                .byte $3E, $20,$CB,$D5,$A0, $34, $20,$CB,$D5,$AD   ; 830
                .byte $3B, 3, $8D, $43, 3,$AD, $3A, 3,$AA, $8E     ; 840
                .byte $42, 3, $20, $2B,$B5, $8A,$D0, 3,$CE, $43    ; 850
                .byte 3,$CA, $18, $8A,$F9, 0, 3,$AD, $43, 3        ; 860
                .byte $F9, 1, 3, $10,$E6,$AD, $2F, 3, $10, $88     ; 870
                .byte $80, $14, $20, $3A,$B3, $80, 3, $20,$F4,$B3  ; 880
                .byte $A2, $3A,$A0, $38, $20, $92,$B2,$AD, $2F, 3  ; 890
                .byte $10,$F1,$EE, $4D, $88,$D0, 3,$EE, $4E, $88   ; 900
                .byte $A2, $3E,$A0, $3C,$DA, $5A, $18,$AD, $14, 3  ; 910
                .byte $79, 0, 3, $8D, $40, 3,$AD, $15, 3, $79      ; 920
                .byte 1, 3, $8D, $41, 3, $18,$AD, $14, 3, $7D      ; 930
                .byte 0, 3, $8D, $44, 3,$AD, $15, 3, $7D, 1        ; 940
                .byte 3, $8D, $45, 3, $18,$AD, $16, 3, $6D, $4D    ; 950
                .byte $88,$A8,$AD, $17, 3, $6D, $4E, $88, $20, 9   ; 960
                .byte $B3, $7A,$FA,$AD, $4D, $88, $D, $4E, $88,$F0 ; 970
                .byte $47, $38,$AD, $14, 3,$FD, 0, 3, $8D, $40     ; 980
                .byte 3,$AD, $15, 3,$FD, 1, 3, $8D, $41, 3         ; 990
                .byte $38,$AD, $14, 3,$F9, 0, 3, $8D, $44, 3       ; 1000
                .byte $AD, $15, 3,$F9, 1, 3, $8D, $45, 3, $38      ; 1010
                .byte $AD, $16, 3,$ED, $4D, $88,$A8,$AD, $17, 3    ; 1020
                .byte $ED, $4E, $88, $8C, $46, 3, $8C, $42, 3, $8D ; 1030
                .byte $47, 3, $8D, $43, 3,$A2, $44,$A0, $40, $4C   ; 1040
                .byte $E7,$DA, $60, $68, $68, $9C, $4D, $88, $9C, $4E; 1050
                .byte $88,$A2, $29,$A0, $40, $20, 5,$B6,$A2, $29     ; 1060
                .byte $A0, $44, $20, $C,$C9,$A2, $44,$A0, $40, $4C   ; 1070
                .byte $92,$B2,$A0, $24,$A2, $14,$A9, $29, $20, $77   ; 1080
                .byte $D6, $9C, $28, 3,$A0, $22,$A2, $16,$A9, $2E    ; 1090
                .byte $20, $77,$D6,$AD, $2E, 3, $D, $2F, 3,$F0       ; 1100
                .byte $C6, $2A, $8D, $41, $88,$A0, $20,$A2, $14,$A9  ; 1110
                .byte $2C, $20, $77,$D6, $9C, $2B, 3, $2A, $4D, $41  ; 1120
                .byte $88, $29, 1, $8D, $41, $88,$A2, $28,$A0, $2E   ; 1130
                .byte $20, $8E,$B5,$A2, $2B,$A0, $2E, $20, $8E,$B5   ; 1140
                .byte $AD, $41, $88,$F0, $E, $38,$A0,$FD,$A9, 0      ; 1150
                .byte $F9, $2E, 2, $99, $2E, 2,$C8,$D0,$F5,$AD       ; 1160
                .byte $2E, 3, $8D, $3C, $88,$AD, $2F, 3, $20,$CD     ; 1170
                .byte $D4,$A0, 3,$B9, $40, $88, $99, $30, 3, $88     ; 1180
                .byte $10,$F7,$A2, $A, $9E, $42, $88,$CA, $10,$FA    ; 1190
                .byte $EE, $45, $88, $20, $23,$B4, $20, $23,$B4, $9C ; 1200
                .byte $4D, $88, $9C, $4E, $88,$A2, $3C,$A0, $36, $20 ; 1210
                .byte 5,$B6,$A2, $3E,$A0, $34, $20, 5,$B6,$A2        ; 1220
                .byte $3C,$A0, $3A, $20,$D5,$D5, $10, 7, $20, $C     ; 1230
                .byte $C9,$A2, $36, $80, $12,$A2, $38,$A0, $3E, $20  ; 1240
                .byte $D5,$D5, $10, $3C,$A2, $34,$A0, $3A, $20, $C   ; 1250
                .byte $C9,$A2, $3E,$A0, $38, $4C, $C,$C9, $20, $23   ; 1260
                .byte $B4,$A0, $3A,$A2, $3C, $20,$D5,$D5, $10, $D    ; 1270
                .byte $AD, $3C, 3, $8D, $3A, 3,$AD, $3D, 3, $8D      ; 1280
                .byte $3B, 3, $60,$A2, $38,$A0, $3E, $20,$D5,$D5     ; 1290
                .byte $10, $C,$AD, $3E, 3, $8D, $38, 3,$AD, $3F      ; 1300
                .byte 3, $8D, $39, 3, $60,$A2, $38,$A0, $34, $20     ; 1310
                .byte $1E,$C9,$A2, $3C,$A0, $38, $20, $1E,$C9, $38   ; 1320
                .byte $AD, $30, 3,$ED, $49, $88, $8D, $36, $88,$AD   ; 1330
                .byte $31, 3,$ED, $4A, $88, $8D, $37, $88,$AD, $32   ; 1340
                .byte 3,$ED, $4B, $88, $8D, $38, $88,$AD, $33, 3     ; 1350
                .byte $ED, $4C, $88, $8D, $39, $88, $9C, $35, $88, $9C; 1360
                .byte $34, $88, $20, $56,$B6,$AD, $28, 3, $8D, $34    ; 1370
                .byte $88,$AD, $29, 3, $8D, $35, $88,$AD, $2A, 3      ; 1380
                .byte $8D, $36, $88, $20, $17,$B6, $18,$AD, $42, $88  ; 1390
                .byte $6D, $35, $88, 8,$AD, $43, $88, $6D, $36, $88   ; 1400
                .byte $8D, $3E, 3,$AD, $44, $88, $6D, $37, $88, $8D   ; 1410
                .byte $3F, 3, $28, $10, 8,$EE, $3E, 3,$D0, 3          ; 1420
                .byte $EE, $3F, 3, $38,$AD, $42, $88,$ED, $35, $88    ; 1430
                .byte 8,$AD, $43, $88,$ED, $36, $88, $8D, $3C, 3      ; 1440
                .byte $AD, $44, $88,$ED, $37, $88, $8D, $3D, 3, $28   ; 1450
                .byte $10, 8,$EE, $3C, 3,$D0, 3,$EE, $3D, 3           ; 1460
                .byte $18,$AD, $45, $88, $6D, $49, $88, $8D, $49, $88 ; 1470
                .byte $AD, $46, $88, $6D, $4A, $88, $8D, $4A, $88,$AD ; 1480
                .byte $47, $88, $6D, $4B, $88, $8D, $4B, $88,$AD, $48 ; 1490
                .byte $88, $6D, $4C, $88, $8D, $4C, $88, $18,$A9, 2   ; 1500
                .byte $6D, $45, $88, $8D, $45, $88, $90, $D,$EE, $46  ; 1510
                .byte $88,$D0, 8,$EE, $47, $88,$D0, 3,$EE, $48        ; 1520
                .byte $88, $18,$AD, $42, $88, $6D, $2B, 3, $8D, $42   ; 1530
                .byte $88,$AD, $43, $88, $6D, $2C, 3, $8D, $43, $88   ; 1540
                .byte $AD, $44, $88, $6D, $2D, 3, $8D, $44, $88,$EE   ; 1550
                .byte $4D, $88,$D0, 3,$EE, $4E, $88,$AD, $2E, 3       ; 1560
                .byte $D0, 3,$CE, $2F, 3,$CE, $2E, 3, $60,$DA         ; 1570
                .byte $5A, $18,$AD, $14, 3, $6D, $42, 3, $8D, $44     ; 1580
                .byte 3,$AD, $15, 3, $6D, $43, 3, $8D, $45, 3         ; 1590
                .byte $18,$AD, $16, 3, $6D, $4D, $88, $8D, $46, 3     ; 1600
                .byte $AD, $17, 3, $6D, $4E, $88, $8D, $47, 3,$A2     ; 1610
                .byte $44, $20, $4B,$DB,$AD, $4D, $88, $D, $4E, $88   ; 1620
                .byte $F0, $2B, $38,$AD, $14, 3,$ED, $42, 3, $8D      ; 1630
                .byte $44, 3,$AD, $15, 3,$ED, $43, 3, $8D, $45        ; 1640
                .byte 3, $38,$AD, $16, 3,$ED, $4D, $88, $8D, $46      ; 1650
                .byte 3,$AD, $17, 3,$ED, $4E, $88, $8D, $47, 3        ; 1660
                .byte $A2, $44, $20, $4B,$DB, $7A,$FA, $60,$DA,$B9    ; 1670
                .byte 0, 3, $8D, $3F, $88,$B9, 1, 3, $8D, $40         ; 1680
                .byte $88,$A0, $18,$BD, 0, 3, $8D, $3A, $88,$BD       ; 1690
                .byte 1, 3, $8D, $3B, $88,$BD, 2, 3, $30, $C          ; 1700
                .byte $88,$F0, $52, $E, $3A, $88, $2E, $3B, $88, $2A  ; 1710
                .byte $10,$F4, $8D, $3C, $88, $9C, $3D, $88, $9C, $3E ; 1720
                .byte $88, $18, $2E, $3A, $88, $2E, $3B, $88, $2E, $3C; 1730
                .byte $88, $2E, $3D, $88, $2E, $3E, $88, $38,$AD, $3D ; 1740
                .byte $88,$ED, $3F, $88,$AA,$AD, $3E, $88,$ED, $40    ; 1750
                .byte $88, $90, 6, $8E, $3D, $88, $8D, $3E, $88, $88  ; 1760
                .byte $D0,$D8,$FA,$AD, $3A, $88, $2A, $9D, 0, 3       ; 1770
                .byte $AD, $3B, $88, $2A, $9D, 1, 3,$AD, $3C, $88     ; 1780
                .byte $2A, $9D, 2, 3, $60,$FA, $60, $38,$A9, 0        ; 1790
                .byte $FD, 0, 3, $99, 0, 3,$A9, 0,$FD, 1              ; 1800
                .byte 3, $99, 1, 3, $60,$A0, $17, $9C, $39, $88       ; 1810
                .byte $9C, $38, $88, $9C, $37, $88, $4E, $36, $88, $6E; 1820
                .byte $35, $88, $6E, $34, $88, $90, $1C, $18,$AD, $30 ; 1830
                .byte $88, $6D, $37, $88, $8D, $37, $88,$AD, $31, $88 ; 1840
                .byte $6D, $38, $88, $8D, $38, $88,$AD, $32, $88, $6D ; 1850
                .byte $39, $88, $8D, $39, $88, $18,$A2, 5, $7E, $34   ; 1860
                .byte $88,$CA, $10,$FA, $88, $10,$D6, $60,$A2, 3      ; 1870
                .byte $9E, $30, $88, $74,$DC,$CA, $10,$F8,$A0, 5      ; 1880
                .byte $B9, $34, $88, $85,$DA, $5A,$A0, 3, $5A, $38    ; 1890
                .byte $2E, $30, $88, $2E, $31, $88, $2E, $32, $88, $2E; 1900
                .byte $33, $88,$A2, 1,$A5,$DC, 6,$DA, $2A, $26        ; 1910
                .byte $DD, $26,$DE, $26,$DF,$CA, $10,$F4, $85,$DC     ; 1920
                .byte $38,$ED, $30, $88, $48,$A5,$DD,$ED, $31, $88    ; 1930
                .byte $AA,$A5,$DE,$ED, $32, $88,$A8,$A5,$DF,$ED       ; 1940
                .byte $33, $88, $90, $E, $85,$DF, $84,$DE, $86,$DD    ; 1950
                .byte $68, $85,$DC,$EE, $30, $88, $80, 4, $68,$CE     ; 1960
                .byte $30, $88, $7A, $88, $10,$B2, $7A, $88, $10,$A6  ; 1970
                .byte $4E, $33, $88, $6E, $32, $88, $6E, $31, $88, $6E; 1980
                .byte $30, $88, $60, $29, 2, $8D, $45, 3, $20, $51    ; 1990
                .byte $C9,$A2, $14, $20,$E6,$C8,$A0, $34, $20, $16    ; 2000
                .byte $C9, $84,$DA,$A2, $34,$A0, $2C,$A9, $28, $20    ; 2010
                .byte $7F,$D5,$A2, $28,$A0, $34, $20,$CB,$D5, $5A     ; 2020
                .byte $DA,$A0, 0, $20,$B6,$D1,$F0, 8, $4A,$F0         ; 2030
                .byte 3, $68, $68, $60,$A2, 0, $68,$A0, $30, $84      ; 2040
                .byte $DA,$A0, $28, $20, $8C,$D5,$A0, $3C, $84,$DA    ; 2050
                .byte $A0, $34, $20, $8C,$D5, $68, $18, $69, 4,$AA    ; 2060
                .byte $DA,$A0, 0, $20,$B6,$D1,$F0, 5, $4A,$F0         ; 2070
                .byte $D9,$A2, 4, $68,$A0, $40, $84,$DA,$A0, $38      ; 2080
                .byte $20, $8C,$D5,$AD, $40, 3,$CD, $3C, 3,$AD        ; 2090
                .byte $41, 3,$ED, $3D, 3, $10, $10,$AD, $45, 3        ; 2100
                .byte $D0, 3, $20, $1F,$C4,$A2, $34, $20, 2,$C9       ; 2110
                .byte $4C, $1F,$C4, $9C, $47, 3,$AD, $30, 3, $2D      ; 2120
                .byte $61, 3, $85,$DA,$AD, $3C, 3, $2D, $61, 3        ; 2130
                .byte $38,$E5,$DA, $10, 6,$CE, $47, 3, $2D, $61       ; 2140
                .byte 3, $8D, $43, 3, $48, $49,$FF, $1A, $2D, $61     ; 2150
                .byte 3, $8D, $42, 3, $68, $18, $6D, $61, 3,$AA       ; 2160
                .byte $BD, $1E,$E1, $85,$E1,$A2, $3C,$A0, $40, $20    ; 2170
                .byte $9B,$DA, $8D, $44, 3,$A5,$D1, $8D, $46, 3       ; 2180
                .byte $A5,$DC, $85,$E0,$A2, 0, $20,$F1,$B7,$F0        ; 2190
                .byte $40,$AD, $2A, 3,$CD, $36, 3,$AD, $2B, 3         ; 2200
                .byte $ED, $37, 3, $50, 2, $49, $80, $30, $11, $20    ; 2210
                .byte $61,$DB,$A2, 0, $20,$DC,$B7,$A2, $C, $20        ; 2220
                .byte $DC,$B7,$D0,$F1, $80, $1D,$A2, $2A,$A0, $2E     ; 2230
                .byte $20,$B0,$E2,$A2, $36,$A0, $3A, $20,$B0,$E2      ; 2240
                .byte $20, $61,$DB,$A2, 0, $20,$E6,$B7,$A2, $C        ; 2250
                .byte $20,$E6,$B7,$D0,$F1, $4C, $61,$DB,$FE, $2A      ; 2260
                .byte 3,$D0, $10,$FE, $2B, 3, $80, $B,$BD, $2A        ; 2270
                .byte 3,$D0, 3,$DE, $2B, 3,$DE, $2A, 3,$BD            ; 2280
                .byte $2A, 3,$DD, $2E, 3,$D0, 6,$BD, $2B, 3           ; 2290
                .byte $DD, $2F, 3, $60                                ; 2300
                .endif

                .if !truncated
;-------------------------------------------------------------------------

LB800:
                lda #$FF
                sta LC2E1
                rts

;-------------------------------------------------------------------------

                lda #$40
                bne LB80C
                lda #$C0

LB80C:
                sta LC2DD
                txa
                tsx
                stx LC2E4
                pha
                jsr LBB55
                jsr LBB35
                plx
                bit L00A1
                bmi LB82C
                lda L00BC
                sta intnmi+$B
                lda L00BD
                sta intnmi+$C
                bne LB836

LB82C:
                lda L00BE
                sta intnmi+$E
                lda L00BE+1
                sta intnmi+$F

LB836:
                lda LC203,x
                pha
                and #$5F
                beq LB842
                pla
                jmp LBEF2

;-------------------------------------------------------------------------

LB842:
                pla
                asl a
                asl a
                asl a
                lda #5
                bcc LB84B
                inc a

LB84B:
                sta intnmi+$5E
                lda LC201,x
                pha
                lda LC202,x
                tax
                pla
                jsr LBF18
                jsr LBEBA
                jsr LB866
                jsr LBCAA

LB863:
                jmp LBF38

;-------------------------------------------------------------------------

LB866:

                jsr LBCCA
                ldx #0

LB86B:
                jsr LB894
                inx
                cpx #3
                bne LB86B
                cmp L00A3
                beq LB881
                lda #1
                trb LC2E1
                lda #$14
                jsr LB993

LB881:
                lda L00A5
                sta L00A3
                bit L00A1
                bvs LB891
                ldy #5
                lda (L00B0),y
                cmp #$B
                beq LB863

LB891:
                jmp LBCCA

;-------------------------------------------------------------------------

LB894:
                lda L00A3,x

LB896:
                sta fcdtrk,x
                cmp fcdtrk,x
                bne LB896
                rts

;-------------------------------------------------------------------------

                tsx
                stx LC2E4
                lda #$10
                sta LC2DD
                jsr LBAE7
                jsr LBD55
                beq LB863
                sta LC2DF
                tsx
                stx LC2E4
                lda #>LC215
                sta L00B1
                lda #<LC215
                sta L00B0
                stz LC2DD
                jsr LBAE7
                jsr LBD0B
                jmp LBF38

;-------------------------------------------------------------------------

                tsx
                stx LC2E4
                pha
                phy
                lda #8
                sta LC2DD
                jsr LB800
                jsr LBB55
                jsr LBB35
                ply
                sty intnmi+$57
                ldx #5
                pla
                and #$20
                beq LB8EB
                inx

LB8EB:
                stx intnmi+$5E
                lda #0
                jsr LB993

LB8F3:
                ldx #<LBA69
                ldy #>LBA69
                jsr LBA2F
                jsr LBA08
                lda L00A3
                cmp #$20
                lda #$F6
                bcc LB907
                eor #2

LB907:
                pha
                lda L00A3
                bit intnmi+$57
                bpl LB919
                pha
                lda intnmi+$5E
                asl a
                asl a
                asl a
                asl a
                pla
                rol a

LB919:
                jsr LBFAF

;-------------------------------------------------------------------------

                .word $92CC

;-------------------------------------------------------------------------

                pla
                sei
                ldx #0
                jsr LB999
                cli
                jsr LBFAF

;-------------------------------------------------------------------------

                .word $97EB

;-------------------------------------------------------------------------

                lda intnmi+$5E
                and #$10
                ora intnmi+$57
                cmp #$A0
                bne LB93C
                jsr LBCC4
                bra LB8F3

;-------------------------------------------------------------------------

LB93C:
                jsr LBCBE
                inc L00A3
                lda intnmi+$57
                bpl LB947
                lsr a

LB947:
                cmp L00A3
                beq LB952
                lda #$50
                jsr LB993
                bra LB8F3

;-------------------------------------------------------------------------

LB952:
                lda #0
                jsr LB993
                ldx #<LBA92
                ldy #>LBA92
                jsr LBA2F
                ldx #6
                bit intnmi+$57
                bmi LB96A
                txa
                bvs LB969
                asl a

LB969:
                tay

LB96A:
                lda LBAD5,y
                sta LCC01,x
                iny
                dex
                bne LB96A
                stz L00A4
                ldy #6
                ldx #0

LB97A:
                phx
                ldx #1
                jsr LB894
                lda #$A6
                plx
                sei
                jsr LB999
                cli
                inc L00A4
                dey
                bpl LB97A
                sty LC2E1

LB990:
                jmp LBF38

;-------------------------------------------------------------------------

LB993:
                cmp #0
                bne LB999
                stz L00A3

;-------------------------------------------------------------------------

LB999:

                pha
                lda intnmi+$5E
                jsr LBCF3
                lda intnmi+$5C
                cmp #2
                bne LB9DD
                pla
                pha
                cmp #$20
                bcs LB9DD
                cmp #$10
                bcc LB9C7
                lda fdcdat
                pha

LB9B5:
                pla
                cmp fcdtrk
                beq LB9DD
                pha
                lda #$50
                bcs LB9C2
                lda #$70

LB9C2:
                jsr LB999
                bra LB9B5

;-------------------------------------------------------------------------

LB9C7:
                lda fcdtrk
                sta fdcdat
                lda #$10
                bra LB9D3

;-------------------------------------------------------------------------

LB9D1:
                lda #$70

LB9D3:
                jsr LB999
                lda fdccmd
                bit #4
                beq LB9D1

LB9DD:
                jsr LBCCA
                pla
                bmi LB9E6
                ora intnmi+$5C

LB9E6:
                sta fdccmd
                bmi LB9FE
                cmp #$20
                bcc LB9FE
                lda intnmi+$5C
                cmp #2
                bne LB9FE
                ldy #$30

LB9F8:
                dec a
                bne LB9F8
                dey
                bne LB9F8

LB9FE:
                jsr LBC56
                lda L00A1
                and #1
                bne LB990
                rts

;-------------------------------------------------------------------------

LBA08:
                lda #$F4
                ldx L00A3

LBA0C:
                clc
                adc #$C
                dex
                bpl LBA0C
                sta L00A4
                ldx #$10
                ldy #4

LBA18:
                lda L00A3
                sta LCC00,y
                lda L00A4
                and #$F
                sta LCC02,y
                tya
                clc
                adc #$F
                tay
                inc L00A4
                dex
                bne LBA18

rtsBA2E:
                rts

;-------------------------------------------------------------------------

LBA2F:
                stx L00B0
                sty L00B1
                ldx #0

LBA35:
                ldy #0
                lda (L00B0),y
                beq rtsBA2E
                pha

LBA3C:
                ldy #1
                lda (L00B0),y
                pha
                iny

LBA42:
                lda (L00B0),y
                iny
                sta LCD00,x
                lda (L00B0),y
                iny
                sta LCC00,x
                inx
                pla
                dec a
                pha
                bne LBA42
                pla
                pla
                dec a
                pha
                bne LBA3C
                pla
                tya
                clc
                adc L00B0
                sta L00B0
                lda #0
                adc L00B1
                sta L00B1
                bra LBA35

;-------------------------------------------------------------------------

LBA69:
                .byte 1
                .byte 1
                .byte $3C       ; <
                .byte $4E       ; N
                .byte $10
                .byte $F
                .byte $C
                .byte 0
                .byte 3
                .byte $F5       ;
                .byte 1
                .byte $FE       ;
                .byte 1
                .byte 0
                .byte 1
                .byte 0
                .byte 1
                .byte 0
                .byte 1
                .byte 1
                .byte 1
                .byte $F7       ;
                .byte $16
                .byte $4E       ; N
                .byte $C
                .byte 0
                .byte 3
                .byte $F5       ;
                .byte 1
                .byte $FB       ;
                .byte 0
                .byte $5A       ; Z
                .byte 1
                .byte $F7       ;
                .byte $39       ; 9
                .byte $4E       ; N
                .byte $F
                .byte 1
                .byte 0
                .byte $4E       ; N
                .byte 0
LBA92:
                .byte 1
                .byte $11
                .byte 1
                .byte 7
                .byte $FB       ;
                .byte 0
                .byte 1
                .byte 0
                .byte 1
                .byte 0
                .byte 1
                .byte 0
                .byte 1
                .byte 0
                .byte 1
                .byte 0
                .byte 1
                .byte 0
                .byte $F9       ;
                .byte 0
                .byte 3
                .byte 0
                .byte 1
                .byte 3
                .byte 2
                .byte 0
                .byte 1
                .byte $48       ; H
                .byte 1
                .byte $75       ; u
                .byte 1
                .byte $67       ; g
                .byte 1
                .byte $6F       ; o
                .byte $FB       ;
                .byte 0
                .byte 3
                .byte 1
                .byte 0
                .byte 0
                .byte 1
                .byte $C
                .byte $CC       ;
                .byte 0
                .byte 1
                .byte $24       ; $
                .byte 9
                .byte 0
                .byte 1
                .byte 2
                .byte 2
                .byte 0
                .byte 1
                .byte $24       ; $
                .byte $21       ; !
                .byte 0
                .byte 1
                .byte $48       ; H
                .byte 1
                .byte $75       ; u
                .byte 1
                .byte $67       ; g
                .byte 1
                .byte $6F       ; o
                .byte 1
                .byte 0
                .byte 0
LBAD5:       .byte 9
                .byte $F9       ;
                .byte 0
                .byte 0
                .byte $A
                .byte 0
                .byte 4
                .byte $F9       ;
                .byte 0
                .byte 0
                .byte 5
                .byte 0
                .byte 2
                .byte $79       ; y
                .byte 0
                .byte 0
                .byte 2
                .byte $80       ;

;-------------------------------------------------------------------------

LBAE7:
                stz LC2E0
                ldy #1
                lda (L00B0),y
                sta L00B2
                iny
                lda (L00B0),y
                sta L00B3
                iny
                lda (L00B0),y
                tax
                iny
                lda (L00B0),y
                inx
                beq LBB02
                inx
                bne LBB06

LBB02:
                cmp #$FF
                beq LBB0F

LBB06:
                bit L00CD
                bpl LBB0F
                jsr LBFAF

;-------------------------------------------------------------------------

                .word $801F

;-------------------------------------------------------------------------

LBB0F:
                ldy #5
                lda (L00B0),y
                cmp #8
                beq LBB27
                cmp #$A
                beq LBB2C
                cmp #$B
                beq LBB27
                lda #$67
                sta LC2E0
                jmp LBF38

;-------------------------------------------------------------------------

LBB27:
                lda #$80
                tsb LC2DD

LBB2C:
                jsr LBB55
                jsr LBB35
                jmp LBE92

;-------------------------------------------------------------------------

LBB35:
                jsr LBB60
                lda LC2E5
                sta intnmi+$5C
                stz L00A0
                stz L00A2
                lda LC2DD
                ora #$20
                sta LC2DD
                sta L00A1
                lda L00CD
                sta intnmi+$5D
                jsr LBB77
                rts

;-------------------------------------------------------------------------

LBB55:
                jsr LBFAF

;-------------------------------------------------------------------------

                .word $9DE8

;-------------------------------------------------------------------------

                and #3
                sta LC2E5
                rts

;-------------------------------------------------------------------------

LBB60:
                lda #$8F
                ldx #$C
                ldy #$FF
                jsr OSBYTE
                sty LC2DE
                rts

;-------------------------------------------------------------------------

LBB6D:
                ldy LC2DE
                lda #$8F
                ldx #$B
                jmp OSBYTE

;-------------------------------------------------------------------------

LBB77:
                ldy #$45

LBB79:
                lda LBC10,y
                sta intnmi,y
                dey
                bpl LBB79
                ldy #1
                lda (L00B0),y
                sta intnmi+$E
                iny
                lda (L00B0),y
                sta intnmi+$F
                bit L00A1
                bmi LBB98
                lda #$5F
                sta intnmi+5

LBB98:
                bit L00CD
                bvc LBBA7
                lda L00A1
                and #$FD
                sta L00A1
                jsr LBBB3
                bmi LBBAA

LBBA7:
                jsr LBBE2

LBBAA:
                sta intnmi+$5F
                lda L00F4
                sta intnmi+$33
                rts

;-------------------------------------------------------------------------

LBBB3:
                lda L00A1
                rol a
                lda #0
                rol a
                ldy #>LC227
                ldx #<LC227
                jsr $406
                lda L00A1
                and #$10
                beq rtsBBD5
                bit L00A1
                bmi LBBD6
                ldy #7

LBBCC:
                lda LBC9A,y
                sta intnmi+$A,y
                dey
                bpl LBBCC

rtsBBD5:
                rts

;-------------------------------------------------------------------------

LBBD6:
                ldy #7

LBBD8:
                lda LBCA2,y
                sta intnmi+$A,y
                dey
                bpl LBBD8
                rts

;-------------------------------------------------------------------------

LBBE2:
                bit L00A1
                bmi rtsBC0F
                ldy #$D

LBBE8:
                lda LBC71,y
                sta intnmi+$A,y
                dey
                bpl LBBE8
                ldy #1
                lda (L00B0),y
                sta intnmi+$B
                iny
                lda (L00B0),y
                sta intnmi+$C
                lda L00A1
                and #8
                beq rtsBC0F
                ldy #$1A

LBC06:
                lda LBC7F,y
                sta intnmi,y
                dey
                bpl LBC06

rtsBC0F:
                rts

;-------------------------------------------------------------------------

LBC10:
                pha
                lda fdccmd
                and #$1F
                cmp #3
                bne LBC2B
                lda fdcdat
                sta $ffff
                inc intnmi+$E
                bne LBC28
                inc intnmi+$F

LBC28:
                pla
                rti

;-------------------------------------------------------------------------

                .byte $EA       ;

;-------------------------------------------------------------------------

LBC2B:
                and #$58
                beq LBC3B
                sta L00A0
                lda #1
                tsb L00A1

LBC35:
                lda #1
                tsb L00A2
                pla
                rti

;-------------------------------------------------------------------------

LBC3B:
                bit L00A2
                bvc LBC35
                lda L00F4
                pha
                lda #0
                sta L00F4
                sta ROMSEL
                phx
                jsr LBE02
                plx
                pla
                sta L00F4
                sta ROMSEL
                pla
                rti

;-------------------------------------------------------------------------

LBC56:
                lda L00A2
                ror a
                bcc LBC5C
                rts

;-------------------------------------------------------------------------

LBC5C:
                lda intnmi+$5D
                and #$10
                beq LBC56
                bit L00FF
                bpl LBC56
                stz LFE24
                lda #$6F
                sta L00A0
                jmp LBF38

;-------------------------------------------------------------------------

LBC71:
                lda $ffff
                sta fdcdat
                inc intnmi+$B
                bne LBC7F
                inc intnmi+$C

LBC7F:
                pha
                lda LCC00,x
                sta fdcdat

;-------------------------------------------------------------------------

LBC86:
                lda fdccmd
                and #1
                beq LBC97
                dec LCD00,x
                bne LBC93
                inx

LBC93:
                pla
                rti

;-------------------------------------------------------------------------

                nop
                nop

LBC97:
                lda fdccmd

LBC9A:
                lda LFEE5
                sta fdcdat
                bcs LBCA8

LBCA2:
                lda fdcdat
                sta LFEE5

LBCA8:
                bcs LBCB0

LBCAA:
                lda #$80
                bit L00A1
                bmi LBCB5

LBCB0:
                lda #$A2
                jsr LBCE4

LBCB5:
                jsr LBCD9
                sta fdccmd
                jmp LBC56

;-------------------------------------------------------------------------

LBCBE:
                lda #$10
                trb intnmi+$5E
                rts

;-------------------------------------------------------------------------

LBCC4:
                lda #$10
                tsb intnmi+$5E
                rts

;-------------------------------------------------------------------------

LBCCA:
                lda #1
                trb L00A2
                rts

;-------------------------------------------------------------------------

LBCCF:
                lda #8
                trb L00A2
                rts

;-------------------------------------------------------------------------

LBCD4:
                lda #2
                trb L00A2
                rts

;-------------------------------------------------------------------------

LBCD9:
                ror LC2E1
                bcc LBCE0
                ora #4

LBCE0:
                asl LC2E1
                rts

;-------------------------------------------------------------------------

LBCE4:
                cmp #$A2
                bne rtsBCF2
                pha
                lda L00A3
                cmp #$20
                pla
                bcc rtsBCF2
                eor #2

rtsBCF2:
                rts

;-------------------------------------------------------------------------

LBCF3:
                pha
                sta LFE24
                lsr LC2E1
                eor LC2E1
                and #3
                beq LBD02
                sec

LBD02:
                eor LC2E1
                rol a
                sta LC2E1
                pla
                rts

;-------------------------------------------------------------------------

LBD0B:
                lda LC2DF
                sta intnmi+$F
                stz intnmi+$E
                jsr LB866
                jsr LBCAA
                lda L00A3
                pha
                lda LC216
                sta L00A5
                lda LC217
                sta L00A6
                stz L00A3
                lda LC2DF
                sta L00A4
                bit L00CD
                bvc LBD46
                ldy #0

LBD34:
                lda (L00A3),y
                ldx #7

LBD38:
                dex
                bne LBD38
                sta LFEE5
                iny
                cpy LC21E
                bne LBD34
                beq LBD51

LBD46:
                ldy LC21E

LBD49:
                dey
                lda (L00A3),y
                sta (L00A5),y
                tya
                bne LBD49

LBD51:
                pla
                sta L00A3
                rts

;-------------------------------------------------------------------------

LBD55:
                jsr LB866
                lda #$40
                tsb L00A2
                ldy #7
                lda (L00B0),y
                sta intnmi+$58
                iny
                lda (L00B0),y
                iny
                clc
                adc (L00B0),y
                sta intnmi+$59
                bcc LBD72
                inc intnmi+$58

LBD72:
                lda intnmi+$58
                tax
                lda intnmi+$59
                ldy #$FF
                jsr LBF2C
                cmp #0
                bne LBD84
                lda #$10

LBD84:
                ldy #9
                sec
                sbc (L00B0),y
                bcs LBDA8
                lda #$10
                sec
                sbc L00A4
                sta intnmi+$58
                lda (L00B0),y
                sec
                sbc intnmi+$58
                ldx #0
                ldy #$FF
                jsr LBF2C
                sty intnmi+$57
                sta intnmi+$59
                bpl LBDB7

LBDA8:
                ldy #9
                lda (L00B0),y
                sta intnmi+$58
                lda #L00FF
                sta intnmi+$57
                stz intnmi+$59

LBDB7:
                stz intnmi+$5A
                inc intnmi+$57
                dec intnmi+$58
                ldx #1
                jsr LB894
                lda #$80
                bit L00A1
                bmi LBDCD
                lda #$A2

LBDCD:
                sta L00A6
                jsr LBCCA
                lda L00A6
                jsr LBCE4
                jsr LBCD9
                sta fdccmd

LBDDD:
                jsr LBC56
                lda L00A2
                and #2
                beq LBDED
                jsr LBCD4
                lda #$54
                bne LBDFB

LBDED:
                lda L00A2
                and #8
                beq rtsBE1E
                jsr LBCCF
                jsr LBCC4
                lda #0

LBDFB:
                inc L00A3
                jsr LB999
                bra LBDDD

;-------------------------------------------------------------------------

LBE02:
                jsr LBCCA
                jsr LBE1F
                txa
                bne LBE10
                lda #1
                tsb L00A2
                rts

;-------------------------------------------------------------------------

LBE10:
                jsr LBCD4
                lda L00A6
                jsr LBCE4
                jsr LBCD9
                sta fdccmd

rtsBE1E:
                rts

;-------------------------------------------------------------------------

LBE1F:
                lda intnmi+$58
                bne LBE80
                lda intnmi+$57
                bne LBE33
                lda intnmi+$59
                beq LBE73
                dec intnmi+$59
                bra LBE83

;-------------------------------------------------------------------------

LBE33:
                lda intnmi+$5A
                bne LBE7B
                lda intnmi+$57
                dec a
                ora intnmi+$59
                beq LBE73
                lda fcdtrk
                cmp #79
                bcc LBE65
                lda intnmi+$5E
                and #$10
                bne LBE77
                lda #$FF
                sta L00A3
                jsr LBCC4
                lda intnmi+$5E
                jsr LBCF3
                lda #1
                tsb LC2E1
                lda #8
                bne LBE67

LBE65:
                lda #2

LBE67:
                tsb L00A2
                dec intnmi+$57
                beq LBE73
                lda #$10
                sta intnmi+$5A

LBE73:
                lda #$FE
                sta L00A4

LBE77:
                ldx #0
                beq LBE85

LBE7B:
                dec intnmi+$5A
                bra LBE83

;-------------------------------------------------------------------------

LBE80:
                dec intnmi+$58

LBE83:
                ldx #$FF

LBE85:
                inc L00A4

LBE87:
                lda L00A4
                sta fdcsec
                cmp fdcsec
                bne LBE87
                rts

;-------------------------------------------------------------------------

LBE92:
                ldy #6
                lda (L00B0),y
                ora LC317
                sta L00A6
                and #$1F
                beq LBEA2
                jmp LBEF2

;-------------------------------------------------------------------------

LBEA2:
                bit L00A6
                bvc LBEAA
                lda #$65
                bne LBEF4

LBEAA:
                lda L00A6
                asl a
                asl a
                asl a
                lda #5
                bcc LBEB4
                inc a

LBEB4:
                sta intnmi+$5E
                jsr LBEE1

;-------------------------------------------------------------------------

LBEBA:
                lda intnmi+$5E
                jsr LBCF3
                ror a
                lda LC2E3
                bcc LBEC9
                lda LC2E2

LBEC9:
                sta L00A3
                bit LC2E1
                bcc LBED4
                bpl rtsBEE0
                bmi LBED6

LBED4:
                bvc rtsBEE0

LBED6:
                lda #1
                tsb LC2E1
                lda #0
                jsr LB993

rtsBEE0:
                rts

;-------------------------------------------------------------------------

LBEE1:
                ldy #7
                lda (L00B0),y
                cmp #$A
                bcc LBF10
                bne LBEF2
                iny
                lda (L00B0),y
                cmp #0
                bcc LBEF8

LBEF2:
                lda #$61

LBEF4:
                sta L00A0
                bne LBF38

LBEF8:
                lda L00A1
                and #$10
                beq LBF10
                ldy #9
                lda (L00B0),y
                dey
                clc
                adc (L00B0),y
                bcs LBF0C
                cmp #1
                bcc LBF10

LBF0C:
                lda #$63
                bne LBEF4

LBF10:
                ldy #7
                lda (L00B0),y
                tax
                iny
                lda (L00B0),y

;-------------------------------------------------------------------------

LBF18:
                ldy #$FF
                jsr LBF2C
                sta L00A4
                sty L00A5
                tya
                sec
                sbc #$50
                bmi rtsBF37
                sta L00A5
                jmp LBCC4

;-------------------------------------------------------------------------

LBF2C:
                sec
                sbc #$10
                iny
                bcs LBF2C
                dex
                bpl LBF2C
                adc #$10

rtsBF37:
                rts

;-------------------------------------------------------------------------

LBF38:
                ldx LC2E4
                txs
                lda LC2DD
                and #$20
                beq LBF6A
                lda intnmi+$5E
                ror a
                lda L00A3
                bcc LBF57
                sta LC2E2
                rol LC2E1
                clc
                ror LC2E1
                bcs LBF62

LBF57:
                sta LC2E3
                lda LC2E1
                and #$BF
                sta LC2E1

LBF62:
                lda L00A0
                sta LC2E0
                jsr LBB6D

LBF6A:
                jsr LBFAF

;-------------------------------------------------------------------------

                .word $8039

;-------------------------------------------------------------------------

                ldx L00B0
                lda LC2E0
                beq LBF7D
                ora #$40
                ldy #$FF
                sty LC2E1

LBF7D:
                ldy L00B1
                and #$7F
                rts

;-------------------------------------------------------------------------

                .byte $FF
                .byte $FF
                .byte $FF
                .byte $FF
                .byte $FF
                .byte $FF
                .byte $FF
                .byte $FF
                .byte $FF
                .byte $FF
                .byte $FF
                .byte $FF
                .byte 1
                .byte 0
                .byte $C0       ;
                .byte $FF
                .byte $FF
                .byte 8
                .byte 0
                .byte 0
                .byte 0
                .byte 2
                .byte 0
                .byte 1
                .byte 0
                .byte $C4       ;
                .byte $FF
                .byte $FF
                .byte 8
                .byte 0
                .byte 0
                .byte 2
                .byte 5
                .byte 0
                .byte 1
                .byte 0
                .byte $C0       ;
                .byte $FF
                .byte $FF
                .byte $A
                .byte 0
                .byte 0
                .byte 0
                .byte 2
                .byte 0

;-------------------------------------------------------------------------

LBFAF:
                jsr LBFC5
                php
                pha
                bra LBFEE

;-------------------------------------------------------------------------

LBFB6:
                inc $10A,x
                inc L00B0
                bne LBFC2
                inc $10B,x
                inc L00B1

LBFC2:
                lda (L00B0)
                rts

;-------------------------------------------------------------------------

LBFC5:
                pha
                pha
                php
                pha
                phx
                lda L00B0
                pha
                lda L00B1
                pha
                tsx
                lda $10A,x
                sta L00B0
                lda $10B,x
                sta L00B1
                jsr LBFB6
                sta $106,x
                jsr LBFB6
                sta $107,x
                pla
                sta L00B1
                pla
                sta L00B0
                plx

LBFEE:
                lda L00F4
                bit #8
                beq LBFF6
                eor #5

LBFF6:
                eor #1
                sta L00F4
                sta ROMSEL
                pla
                plp
                rts

                .endif

;-------------------------------------------------------------------------
